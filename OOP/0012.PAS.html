<html>
<head><title> "OOPCOPY.PAS" by ANDRES CVITKOVICH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{************************************************}
{                                                }
{   Turbo Pascal 6.0                             }
{   Turbo Vision Utilities                       }
{   Written (w) 1993 by Andres Cvitkovich        }
{                                                }
{   Public Domain                                }
{                                                }
{************************************************}

</i></font><font color="#FF0000"><b>Unit </b></font>TVUtis<font color="#000080">;

</font><font color="#008000"><i>{$F+,O+,S-,D-,B-}

</i></font><font color="#FF0000"><b>Interface

Uses </b></font>Dos<font color="#000080">, </font>Objects<font color="#000080">, </font>Views<font color="#000080">, </font>App<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>PProgressBar <font color="#000080">= ^</font>TProgressBar<font color="#000080">;
  </font>TProgressBar <font color="#000080">= </font><font color="#FF0000"><b>Object </b></font><font color="#000080">(</font>TView<font color="#000080">)
    </font>empty<font color="#000080">, </font>filled<font color="#000080">: </font>Char<font color="#000080">;
    </font>total<font color="#000080">: </font>LongInt<font color="#000080">;
    </font>percent<font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Constructor </b></font>Init <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Bounds<font color="#000080">: </font>TRect<font color="#000080">; </font>ch_empty<font color="#000080">,
      </font>ch_filled<font color="#000080">: </font>Char<font color="#000080">; </font>totalwork<font color="#000080">: </font>LongInt<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>Draw<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Procedure </b></font>SetTotal <font color="#000080">(</font>newtotal<font color="#000080">: </font>LongInt<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>Update <font color="#000080">(</font>nowdone<font color="#000080">: </font>LongInt<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Procedure </b></font>UpdatePercent <font color="#000080">(</font>newpercent<font color="#000080">: </font>Integer<font color="#000080">); </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>PFileCopy <font color="#000080">= ^</font>TFileCopy<font color="#000080">;
  </font>TFileCopy <font color="#000080">= </font><font color="#FF0000"><b>Object
    </b></font>bufsize<font color="#000080">: </font>Word<font color="#000080">;
    </font>buffer<font color="#000080">: </font>Pointer<font color="#000080">;
    </font><font color="#FF0000"><b>ConstRUCTOR </b></font>Init <font color="#000080">(</font>BufferSize<font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Function  </b></font>SetBufferSize <font color="#000080">(</font>newsize<font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">; </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Function  </b></font>CopyFile <font color="#000080">(</font>File1<font color="#000080">, </font>File2<font color="#000080">: </font>PathStr<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Procedure </b></font>Progress <font color="#000080">(</font>Bytesdone<font color="#000080">, </font>Bytestotal<font color="#000080">: </font>LongInt<font color="#000080">;
      </font>percent<font color="#000080">: </font>Integer<font color="#000080">); </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Function  </b></font>Error <font color="#000080">(</font>code<font color="#000080">: </font>Word<font color="#000080">): </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Uses </b></font>drivers<font color="#000080">;

</font><font color="#FF0000"><b>Constructor </b></font>TProgressBar<font color="#000080">.</font>Init <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Bounds<font color="#000080">: </font>TRect<font color="#000080">; </font>ch_empty<font color="#000080">, </font>ch_filled<font color="#000080">: </font>Char<font color="#000080">;
</font>totalwork<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>TView<font color="#000080">.</font>Init <font color="#000080">(</font>Bounds<font color="#000080">);
  </font>total  <font color="#000080">:= </font>totalwork<font color="#000080">;
  </font>empty  <font color="#000080">:= </font>ch_empty<font color="#000080">;
  </font>filled <font color="#000080">:= </font>ch_filled<font color="#000080">;
  </font>percent <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TProgressBar<font color="#000080">.</font>Draw<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>B<font color="#000080">: </font>TDrawBuffer<font color="#000080">;
  </font>C<font color="#000080">: </font>Byte<font color="#000080">;
  </font>y<font color="#000080">: </font>Byte<font color="#000080">;
  </font>newbar<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>Size<font color="#000080">.</font>X <font color="#000080">* </font>Size<font color="#000080">.</font>Y<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;              </font><font color="#008000"><i>{ Exit if no extent }
  </i></font>C <font color="#000080">:= </font>GetColor <font color="#000080">(</font><font color="#800000">6</font><font color="#000080">);
  </font>MoveChar <font color="#000080">(</font>B<font color="#000080">, </font>empty<font color="#000080">, </font>C<font color="#000080">, </font>Size<font color="#000080">.</font>X<font color="#000080">);
  </font>MoveChar <font color="#000080">(</font>B<font color="#000080">, </font>filled<font color="#000080">, </font>C<font color="#000080">, </font>Size<font color="#000080">.</font>X <font color="#000080">* </font>percent <font color="#FF0000"><b>div </b></font><font color="#800000">100</font><font color="#000080">);
  </font>WriteLine <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>Size<font color="#000080">.</font>X<font color="#000080">, </font>Size<font color="#000080">.</font>Y<font color="#000080">, </font>B<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>TProgressBar<font color="#000080">.</font>SetTotal <font color="#000080">(</font>newtotal<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>total <font color="#000080">:= </font>newtotal
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TProgressBar<font color="#000080">.</font>Update <font color="#000080">(</font>nowdone<font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>newpercent<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>total<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
  </font>newpercent <font color="#000080">:= </font><font color="#800000">100 </font><font color="#000080">* </font>nowdone <font color="#FF0000"><b>div </b></font>total<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>newpercent <font color="#000080">&gt; </font><font color="#800000">100 </font><font color="#FF0000"><b>then </b></font>newpercent <font color="#000080">:= </font><font color="#800000">100</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>percent <font color="#000080">&lt;&gt; </font>newpercent <font color="#FF0000"><b>then begin
    </b></font>percent <font color="#000080">:= </font>newpercent<font color="#000080">;
    </font>DrawView
  <font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TProgressBar<font color="#000080">.</font>UpdatePercent <font color="#000080">(</font>newpercent<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>newpercent <font color="#000080">&gt; </font><font color="#800000">100 </font><font color="#FF0000"><b>then </b></font>newpercent <font color="#000080">:= </font><font color="#800000">100</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>percent <font color="#000080">&lt;&gt; </font>newpercent <font color="#FF0000"><b>then begin
    </b></font>percent <font color="#000080">:= </font>newpercent<font color="#000080">;
    </font>DrawView
  <font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{
  TFileCopy.Init
  &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;

  initializes the Object and allocates memory

    BufferSize   size of buffer in Bytes to be allocated For disk i/o

}
</i></font><font color="#FF0000"><b>ConstRUCTOR </b></font>TFileCopy<font color="#000080">.</font>Init <font color="#000080">(</font>BufferSize<font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>begin
  If </b></font>MaxAvail <font color="#000080">&lt; </font>BufferSize <font color="#FF0000"><b>Then
    </b></font>bufsize <font color="#000080">:= </font><font color="#800000">0
  </font><font color="#FF0000"><b>Else
    </b></font>bufsize <font color="#000080">:= </font>BufferSize<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>bufsize <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>GetMem <font color="#000080">(</font>buffer<font color="#000080">, </font>bufsize<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{
  TFileCopy.Done
  &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;

  Destructor, free up buffer memory

}
</i></font><font color="#FF0000"><b>Destructor </b></font>TFileCopy<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font>bufsize <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>FreeMem <font color="#000080">(</font>buffer<font color="#000080">, </font>bufsize<font color="#000080">);
  </font><font color="#008000"><i>{ bufsize := 0; }   { man wei&aacute; ja nie... }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{
  TFileCopy.SetBufferSize
  &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;

  change buffer size

    NewSize = new size of disk i/o buffer in Bytes

}
</i></font><font color="#FF0000"><b>Function </b></font>TFileCopy<font color="#000080">.</font>SetBufferSize <font color="#000080">(</font>newsize<font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  If </b></font>MaxAvail <font color="#000080">&gt;= </font>newsize <font color="#FF0000"><b>Then begin
    If </b></font>bufsize <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>FreeMem <font color="#000080">(</font>buffer<font color="#000080">, </font>bufsize<font color="#000080">);
    </font>bufsize <font color="#000080">:= </font>newsize<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>bufsize <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>GetMem <font color="#000080">(</font>buffer<font color="#000080">, </font>bufsize<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>SetBufferSize <font color="#000080">:= </font>bufsize
<font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{
  TFileCopy.CopyFile
  &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;

  copy a File onto another; no wildcards allowed
  calls Progress and Error

    File1   source File
    File2   target File

  Error code returned:

   1  low on buffer memory
   2  error opening source File
   3  error creating destination File
   4  error reading from source File
   5  error writing to destination File
   6  error writing File date/time and/or attributes

}
</i></font><font color="#FF0000"><b>Function </b></font>TFileCopy<font color="#000080">.</font>CopyFile <font color="#000080">(</font>File1<font color="#000080">, </font>File2<font color="#000080">: </font>PathStr<font color="#000080">): </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>fsrc<font color="#000080">, </font>fdest<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>fsize<font color="#000080">, </font>ftime<font color="#000080">, </font>cnt<font color="#000080">, </font>cnt1<font color="#000080">: </font>LongInt<font color="#000080">;
    </font>fattr<font color="#000080">, </font>rd<font color="#000080">, </font>wr<font color="#000080">, </font>iores<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{$I-}
  </i></font><font color="#FF0000"><b>If </b></font>bufsize <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font>CopyFile <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">; </font>Exit <font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Assign <font color="#000080">(</font>fsrc<font color="#000080">, </font>File1<font color="#000080">);
  </font><font color="#FF0000"><b>Repeat
    </b></font>Reset <font color="#000080">(</font>fsrc<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font>iores <font color="#000080">:= </font>IOResult<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>iores <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
      If </b></font>Error <font color="#000080">(</font>iores<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>Then begin
        </b></font>CopyFile <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
        </font>Exit
      <font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>iores <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>Assign <font color="#000080">(</font>fdest<font color="#000080">, </font>File2<font color="#000080">);
  </font><font color="#FF0000"><b>Repeat
    </b></font>ReWrite <font color="#000080">(</font>fdest<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font>iores <font color="#000080">:= </font>IOResult<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>iores <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
      If </b></font>Error <font color="#000080">(</font>iores<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>Then begin
        </b></font>Close <font color="#000080">(</font>fsrc<font color="#000080">);
        </font>CopyFile <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
        </font>Exit
      <font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>iores <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>fsize <font color="#000080">:= </font>FileSize <font color="#000080">(</font>fsrc<font color="#000080">);
  </font>GetFTime <font color="#000080">(</font>fsrc<font color="#000080">, </font>ftime<font color="#000080">);
  </font>GetFAttr <font color="#000080">(</font>fsrc<font color="#000080">, </font>fattr<font color="#000080">);
  </font><font color="#FF0000"><b>Repeat
    Repeat
      </b></font>cnt <font color="#000080">:= </font>FilePos <font color="#000080">(</font>fsrc<font color="#000080">);
      </font>BlockRead <font color="#000080">(</font>fsrc<font color="#000080">, </font>buffer<font color="#000080">^, </font>bufsize<font color="#000080">, </font>rd<font color="#000080">);
      </font>iores <font color="#000080">:= </font>IOResult<font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>iores <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then begin
        If </b></font>Error <font color="#000080">(</font>iores<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>Then begin      </b></font><font color="#008000"><i>{abort?}
          </i></font>Close <font color="#000080">(</font>fsrc<font color="#000080">);                      </font><font color="#008000"><i>{* }
          </i></font>Close <font color="#000080">(</font>fdest<font color="#000080">);                     </font><font color="#008000"><i>{* hier k”nnte man auch}
          </i></font>Erase <font color="#000080">(</font>fdest<font color="#000080">);                     </font><font color="#008000"><i>{* Error aufrufen, naja...}
          </i></font>CopyFile <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
          </font>Exit<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>Seek <font color="#000080">(</font>fsrc<font color="#000080">, </font>cnt<font color="#000080">);      </font><font color="#008000"><i>{step back on retry!}
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Until </b></font>iores <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>rd <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      Repeat
        </b></font>cnt1 <font color="#000080">:= </font>FilePos <font color="#000080">(</font>fdest<font color="#000080">);
        </font>BlockWrite <font color="#000080">(</font>fdest<font color="#000080">, </font>buffer<font color="#000080">^, </font>rd<font color="#000080">, </font>wr<font color="#000080">);
        </font>iores <font color="#000080">:= </font>IOResult<font color="#000080">;
        </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>rd <font color="#000080">&lt;&gt; </font>wr<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>iores <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then begin
          If </b></font>Error <font color="#000080">(</font>iores<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>Then begin      </b></font><font color="#008000"><i>{abort?}
            </i></font>Close <font color="#000080">(</font>fsrc<font color="#000080">);                      </font><font color="#008000"><i>{* }
            </i></font>Close <font color="#000080">(</font>fdest<font color="#000080">);                     </font><font color="#008000"><i>{* hier k”nnte man auch}
            </i></font>Erase <font color="#000080">(</font>fdest<font color="#000080">);                     </font><font color="#008000"><i>{* Error aufrufen, naja...}
            </i></font>CopyFile <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
            </font>Exit<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>Seek <font color="#000080">(</font>fdest<font color="#000080">, </font>cnt1<font color="#000080">);      </font><font color="#008000"><i>{step back on retry!}
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>rd <font color="#000080">= </font>wr<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>iores <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
    </font>Progress <font color="#000080">(</font>cnt<font color="#000080">, </font>fsize<font color="#000080">, </font>cnt <font color="#000080">* </font><font color="#800000">100 </font><font color="#FF0000"><b>div </b></font>fsize<font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>rd <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>rd <font color="#000080">&lt;&gt; </font>wr<font color="#000080">);
  </font>Close <font color="#000080">(</font>fsrc<font color="#000080">);
  </font><font color="#FF0000"><b>Repeat
    </b></font>Close <font color="#000080">(</font>fdest<font color="#000080">);     </font><font color="#008000"><i>{close&amp;flush}
    </i></font>iores <font color="#000080">:= </font>IOResult<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>iores <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then If </b></font>Error <font color="#000080">(</font>iores<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>iores <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>Reset <font color="#000080">(</font>fdest<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then begin </b></font>CopyFile <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">; </font>Exit <font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>SetFTime <font color="#000080">(</font>fdest<font color="#000080">, </font>ftime<font color="#000080">);
  </font>SetFAttr <font color="#000080">(</font>fdest<font color="#000080">, </font>fattr<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then begin </b></font>Close <font color="#000080">(</font>fdest<font color="#000080">); </font>CopyFile <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">; </font>Exit <font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Close <font color="#000080">(</font>fdest<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{
  TFileCopy.Progress
  &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;

  is called by CopyFile to allow displaying a progress bar or s.e.

    Bytesdone    Bytes read in and written
    Bytestotal   Bytes to read&amp;Write total (that is, File size)
    percent      amount done in percent

}
</i></font><font color="#FF0000"><b>Procedure </b></font>TFileCopy<font color="#000080">.</font>Progress <font color="#000080">(</font>Bytesdone<font color="#000080">, </font>Bytestotal<font color="#000080">: </font>LongInt<font color="#000080">; </font>percent<font color="#000080">:
</font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{abstract - inherit For use!}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{
  TFileCopy.Error
  &Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;

  is called by CopyFile if an error occured during the copy process

    code   the IOResult code &lt;&gt; 0

  should return an Integer value:

    0  Repeat action
    1  abort

  Note: TurboVision installs it's own Dos critical error handler, so you
        don't need to overWrite Error (only called if Abort is chosen from
        the TV Error Msg) if you use CopyFile in a TV Program.

}
</i></font><font color="#FF0000"><b>Function </b></font>TFileCopy<font color="#000080">.</font>Error <font color="#000080">(</font>code<font color="#000080">: </font>Word<font color="#000080">): </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Error <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font><font color="#008000"><i>{
&gt; Unit TVUtis;
&gt;
&gt;   Wow...never seen so much code just to copy a File! =)

well, it's a quite extendable Object, and there's a lot of error-checking,
too.  just see below... :-)

&gt;   I haven't tried OOP yet, and probably was lucky to

&gt;      Anyways, I see you left out a progress display in
&gt;   TFileCopy.Progress, but the Unit also has an a progress bar
&gt;   Object.  Any way to marry the two?

of course, that's why I put them together!
but I didn't want to have the progress bar (and along With this Turbo Vision)
being an essential part of the FileCopy Object, since some guys might want to
Write their own ProgressBars or use the whole Object in a non-TV Program.

&gt;    I implemented your TCopyFile like so...
&gt;
&gt;     Uses Dos, TVUtis;
&gt;     Var
&gt;       DoCopy: TFileCopy;
&gt;       F1, F2: PathStr;
&gt;       R: Integer;
&gt;     begin
&gt;       F1 := 'C:\tp\copyf.pas';
&gt;       F2 := 'C:\copyf.pas';
&gt;       DoCopy.Init(4096);
&gt;       R := DoCopy.CopyFile(F1, F2);
&gt;       DoCopy.Done;
&gt;       Writeln(R);
&gt;     end.

Absolutely correct, no doubt. But poor Graphics...  ;-)

&gt;      How would one modify that and TFileCopy.Progress to use
&gt;     TProgressBar? From what I can surmise, you'd init
&gt;      TProgressBar and then TFilecopy.Progress would
&gt;       call it somehow, like TProgressBar.Update?
&gt;       I don't see what I should put For the totalwork of
&gt;       TProgressBar.Init; the size of the File? Then that
&gt;       means I must cal TProgress.Init from inside
&gt;       TFileCopy.CopyFile (after we have the size of the
&gt;       File.) And TFileCopy.Progress would call
&gt;        TProgressBar.Update.

first of all: The TProgressBar Object is written For Turbo Vision, you can't
use it within a non-TV Program. Next, you have to derive your own Object from
TFileCopy and overWrite the method Progress that calls TProgressBar. Take the
following as an example:
}

</i></font><font color="#FF0000"><b>Type
  </b></font>PXFileCopy <font color="#000080">= ^</font>TXFileCopy<font color="#000080">;
  </font>TXFileCopy <font color="#000080">= </font><font color="#FF0000"><b>Object </b></font><font color="#000080">(</font>TFileCopy<font color="#000080">)
    </font>AProgressBar<font color="#000080">: </font>PProgressBar<font color="#000080">;
    </font><font color="#FF0000"><b>ConstRUCTOR </b></font>Init <font color="#000080">(</font>BufferSize<font color="#000080">: </font>Word<font color="#000080">; </font>ProgBar<font color="#000080">: </font>PProgressBar<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>Progress <font color="#000080">(</font>Bytesdone<font color="#000080">, </font>Bytestotal<font color="#000080">: </font>LongInt<font color="#000080">;
                        </font>percent<font color="#000080">: </font>Integer<font color="#000080">); </font><font color="#FF0000"><b>VIRTUAL</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ConstRUCTOR </b></font>TXFileCopy<font color="#000080">.</font>Init <font color="#000080">(</font>BufferSize<font color="#000080">: </font>Word<font color="#000080">; </font>ProgBar<font color="#000080">: </font>PProgressBar<font color="#000080">);
</font><font color="#FF0000"><b>begin
  inherited </b></font>Init <font color="#000080">(</font>BufferSize<font color="#000080">);     </font><font color="#008000"><i>{ or TFileCopy.Init For TP 6 }
  </i></font>AProgressBar <font color="#000080">:= </font>ProgBar<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TXFileCopy<font color="#000080">.</font>Progress <font color="#000080">(</font>Bytesdone<font color="#000080">, </font>Bytestotal<font color="#000080">: </font>LongInt<font color="#000080">;
                               </font>percent<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  if </b></font>AProgressBar <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL then
    </b></font>AProgressBar<font color="#000080">^.</font>UpdatePercent <font color="#000080">(</font>percent<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{
You then would use this Object (in a Turbo Vision Program) as follows:
}

</i></font><font color="#FF0000"><b>Function </b></font>TMyApp<font color="#000080">.</font>CopyFile <font color="#000080">(</font>source<font color="#000080">, </font>dest<font color="#000080">: </font>PathStr<font color="#000080">): </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Dlg<font color="#000080">: </font>TDialog<font color="#000080">;
  </font>MyBar<font color="#000080">: </font>PProgressBar<font color="#000080">;
  </font>R<font color="#000080">: </font>TRect<font color="#000080">;
  </font>DoCopy<font color="#000080">: </font>TXFileCopy<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>R<font color="#000080">.</font>Assign <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">40</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
  </font>Dlg<font color="#000080">.</font>Init <font color="#000080">(</font>R<font color="#000080">, </font><font color="#800000">'Copying File...'</font><font color="#000080">);
  </font>Dlg<font color="#000080">.</font>Options <font color="#000080">:= </font>Dlg<font color="#000080">.</font>Options <font color="#FF0000"><b>or </b></font>ofCentered<font color="#000080">;
  </font>Dlg<font color="#000080">.</font>Flags <font color="#000080">:= </font>Dlg<font color="#000080">.</font>Flags <font color="#FF0000"><b>and not </b></font>wfClose<font color="#000080">;
  </font>R<font color="#000080">.</font>Assign <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">38</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
  </font>Dlg<font color="#000080">.</font>Insert <font color="#000080">(</font>New <font color="#000080">(</font>PStaticText<font color="#000080">, </font>Init <font color="#000080">(</font>R<font color="#000080">, ^</font>C<font color="#800000">'copying '</font><font color="#000080">+</font>source<font color="#000080">+</font><font color="#800000">#13</font><font color="#000080">+
                                      ^</font>C<font color="#800000">'to '</font><font color="#000080">+</font>dest<font color="#000080">+</font><font color="#800000">', please wait...'</font><font color="#000080">)));
  </font>R<font color="#000080">.</font>Assign <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">38</font><font color="#000080">,</font><font color="#800000">6</font><font color="#000080">);
  </font>Dlg<font color="#000080">.</font>Insert <font color="#000080">(</font>New <font color="#000080">(</font>PStaticText<font color="#000080">, </font>Init <font color="#000080">(</font>R<font color="#000080">,
                   </font><font color="#800000">'0%              50%             100%'</font><font color="#000080">)));
  </font>R<font color="#000080">.</font>Move <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>MyBar <font color="#000080">:= </font>New <font color="#000080">(</font>PProgressBar<font color="#000080">, </font>Init <font color="#000080">(</font>R<font color="#000080">, </font><font color="#800000">'&deg;'</font><font color="#000080">, </font><font color="#800000">'&sup2;'</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">));
  </font>Dlg<font color="#000080">.</font>Insert <font color="#000080">(</font>MyBar<font color="#000080">);
  </font>Desktop<font color="#000080">^.</font>Insert <font color="#000080">(@</font>Dlg<font color="#000080">);
  </font>DoCopy<font color="#000080">.</font>Init <font color="#000080">(</font><font color="#800000">4096</font><font color="#000080">, </font>MyBar<font color="#000080">);
  </font>ErrorCode <font color="#000080">:= </font>DoCopy<font color="#000080">.</font>CopyFile <font color="#000080">(</font>source<font color="#000080">, </font>dest<font color="#000080">);
  </font>DoCopy<font color="#000080">.</font>Done<font color="#000080">;
  </font>Dlg<font color="#000080">.</font>Done<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ErrorCode <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>MessageBox <font color="#000080">(</font><font color="#800000">'Error copying File!'</font><font color="#000080">, </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">, </font>mfError<font color="#000080">+</font>mfOkButton<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{
If you don't want to have any progress bar at all, just pass NIL instead of
MyBar to DoCopy.Init. And maybe you want to add this Functionality directly to
TFileCopy rather than deriving a new Object.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to OOP SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p></body>
</html>

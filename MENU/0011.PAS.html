<html>
<head><title> "Text Interface Unit" by SUNE MARCHER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MENU SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0011.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>iface<font color="#000080">; </font><font color="#008000"><i>{ INTERFACE, for creating TEXT interfaces. }

</i></font><font color="#FF0000"><b>INTERFACE

uses </b></font>crt<font color="#000080">,</font>dos<font color="#000080">,</font>link<font color="#000080">,</font>txtwin<font color="#000080">;
     </font><font color="#008000"><i>{ NOTE : Link in POINTERS.SWG
              txtwin in TEXTWNDW.SWG }

</i></font><font color="#FF0000"><b>const
  </b></font>kbnull<font color="#000080">=</font><font color="#800000">#0</font><font color="#000080">;
  </font>kbesc<font color="#000080">=</font><font color="#800000">#27</font><font color="#000080">;
  </font>kbpgup<font color="#000080">=</font><font color="#800000">#73</font><font color="#000080">;
  </font>kbpgdown<font color="#000080">=</font><font color="#800000">#81</font><font color="#000080">;
  </font>kbhome<font color="#000080">=</font><font color="#800000">#71</font><font color="#000080">;
  </font>kbend<font color="#000080">=</font><font color="#800000">#79</font><font color="#000080">;
  </font>kbleft<font color="#000080">=</font><font color="#800000">#75</font><font color="#000080">;
  </font>kbright<font color="#000080">=</font><font color="#800000">#77</font><font color="#000080">;
  </font>kbup<font color="#000080">=</font><font color="#800000">#72</font><font color="#000080">;
  </font>kbdown<font color="#000080">=</font><font color="#800000">#80</font><font color="#000080">;
  </font>kbf1<font color="#000080">=</font><font color="#800000">#59</font><font color="#000080">;
  </font>kbenter<font color="#000080">=</font><font color="#800000">#13</font><font color="#000080">;
  </font>kbdel<font color="#000080">=</font><font color="#800000">#83</font><font color="#000080">;
  </font>kbbackspace<font color="#000080">=</font><font color="#800000">#8</font><font color="#000080">;
  </font>colseg<font color="#000080">:</font>word<font color="#000080">=</font><font color="#800000">$b800</font><font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>tchok<font color="#000080">=</font><font color="#FF0000"><b>set of </b></font>char<font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>getkey<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font><font color="#FF0000"><b>const </b></font>chok<font color="#000080">:</font>tchok<font color="#000080">):</font>char<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>getstring<font color="#000080">(</font>col<font color="#000080">,</font>x<font color="#000080">,</font>y<font color="#000080">,</font>max<font color="#000080">:</font>byte<font color="#000080">;</font>legalch<font color="#000080">:</font>tchok<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>xorbar<font color="#000080">(</font>x1<font color="#000080">,</font>x2<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>c<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>function  </b></font>selectbar<font color="#000080">(</font>xp<font color="#000080">,</font>yp<font color="#000080">,</font>x2<font color="#000080">,</font>num<font color="#000080">,</font>col<font color="#000080">,</font>ystart<font color="#000080">:</font>byte<font color="#000080">;</font>abort<font color="#000080">:</font>boolean<font color="#000080">):</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>function  </b></font>selectfile<font color="#000080">(</font>wildcard<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>x<font color="#000080">,</font>y<font color="#000080">,</font>col<font color="#000080">:</font>byte<font color="#000080">;</font>abort<font color="#000080">:</font>boolean<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

var
  </b></font>dirlink<font color="#000080">:</font>plink<font color="#000080">;
  </font>dirinfo<font color="#000080">:</font>searchrec<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>getkey<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font><font color="#FF0000"><b>const </b></font>chok<font color="#000080">:</font>tchok<font color="#000080">):</font>char<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>ch<font color="#000080">:</font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>write<font color="#000080">(</font>s<font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    </b></font>ch<font color="#000080">:=</font>readkey<font color="#000080">;
  </font><font color="#FF0000"><b>until</b></font><font color="#000080">(</font>ch <font color="#FF0000"><b>in </b></font>chok<font color="#000080">);
  </font>getkey<font color="#000080">:=</font>ch<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>getstring<font color="#000080">(</font>col<font color="#000080">,</font>x<font color="#000080">,</font>y<font color="#000080">,</font>max<font color="#000080">:</font>byte<font color="#000080">;</font>legalch<font color="#000080">:</font>tchok<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>ch<font color="#000080">:</font>char<font color="#000080">;
  </font>input<font color="#000080">,</font>temp<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>oldcol<font color="#000080">,</font>i<font color="#000080">,</font>xpos<font color="#000080">,</font>ypos<font color="#000080">:</font>byte<font color="#000080">;
  </font>hoejre<font color="#000080">,</font>venstre<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">23</font><font color="#000080">];
</font><font color="#FF0000"><b>begin
  </b></font>getstring<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font>gotoxy<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">);
  </font>oldcol<font color="#000080">:=</font>textattr<font color="#000080">;
  </font>textattr<font color="#000080">:=</font>col<font color="#000080">;
  </font>ch<font color="#000080">:=</font><font color="#800000">#0</font><font color="#000080">;
  </font>input<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">; </font>hoejre<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">; </font>venstre<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font>xpos<font color="#000080">:=</font>x<font color="#000080">; </font>ypos<font color="#000080">:=</font>y<font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>gotoxy<font color="#000080">(</font>xpos<font color="#000080">,</font>ypos<font color="#000080">);
    </font>venstre<font color="#000080">:=</font>copy<font color="#000080">(</font>input<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>xpos<font color="#000080">-</font><font color="#800000">13</font><font color="#000080">);
    </font>hoejre<font color="#000080">:=</font>copy<font color="#000080">(</font>input<font color="#000080">,</font>xpos<font color="#000080">-</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">36</font><font color="#000080">-</font>xpos<font color="#000080">);
    </font><font color="#FF0000"><b>repeat
      </b></font>ch<font color="#000080">:=</font>readkey<font color="#000080">;
    </font><font color="#FF0000"><b>until</b></font><font color="#000080">(</font>ch <font color="#FF0000"><b>in </b></font>legalch<font color="#000080">);
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ch<font color="#000080">=</font>kbnull<font color="#000080">)</font><font color="#FF0000"><b>then
    begin
      </b></font>ch<font color="#000080">:=</font>readkey<font color="#000080">;
      </font><font color="#FF0000"><b>case </b></font>ch <font color="#FF0000"><b>of
        </b></font>kbhome<font color="#000080">:</font>xpos<font color="#000080">:=</font>x<font color="#000080">;
        </font>kbleft<font color="#000080">:</font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>xpos<font color="#000080">&gt;</font>x<font color="#000080">)</font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>xpos<font color="#000080">);
        </font>kbright<font color="#000080">:</font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>xpos<font color="#000080">&lt;</font>ord<font color="#000080">(</font>input<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])+</font>x<font color="#000080">)</font><font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>xpos<font color="#000080">);
        </font>kbdel<font color="#000080">:</font><font color="#FF0000"><b>begin
</b></font><font color="#008000"><i>{                hoejre:=copy(hoejre,2,length(hoejre)-1);
                input:=venstre+hoejre;}
                </i></font>delete<font color="#000080">(</font>input<font color="#000080">,(</font>xpos<font color="#000080">-</font>x<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>kbend<font color="#000080">:</font><font color="#FF0000"><b>begin
                </b></font>xpos<font color="#000080">:=</font>ord<font color="#000080">(</font>input<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])+</font>x<font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end else if</b></font><font color="#000080">(</font>ord<font color="#000080">(</font>input<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])&lt;</font>max<font color="#000080">)</font><font color="#FF0000"><b>and</b></font><font color="#000080">(</font>ch<font color="#000080">&lt;&gt;</font>kbbackspace<font color="#000080">)</font><font color="#FF0000"><b>and
               </b></font><font color="#000080">(</font>ch<font color="#000080">&lt;&gt;</font>kbenter<font color="#000080">)</font><font color="#FF0000"><b>then
    begin
</b></font><font color="#008000"><i>{      input:=venstre+ch+hoejre;     (* inds‘t karakter *)}
      </i></font>temp<font color="#000080">:=</font>copy<font color="#000080">(</font>input<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,(</font>xpos<font color="#000080">-</font>x<font color="#000080">));
      </font>temp<font color="#000080">:=</font>temp<font color="#000080">+</font>ch<font color="#000080">;
      </font>temp<font color="#000080">:=</font>temp<font color="#000080">+</font>copy<font color="#000080">(</font>input<font color="#000080">,(</font>xpos<font color="#000080">-</font>x<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font>length<font color="#000080">(</font>input<font color="#000080">));
      </font>input<font color="#000080">:=</font>temp<font color="#000080">;
      </font>write<font color="#000080">(</font>ch<font color="#000080">);
      </font>inc<font color="#000080">(</font>xpos<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ch<font color="#000080">=</font>kbbackspace<font color="#000080">)</font><font color="#FF0000"><b>then
    begin
      if</b></font><font color="#000080">(</font>ord<font color="#000080">(</font>input<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then
      begin
        if</b></font><font color="#000080">(</font>xpos<font color="#000080">&gt;</font>x<font color="#000080">)</font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>xpos<font color="#000080">);
        </font>delete<font color="#000080">(</font>venstre<font color="#000080">,(</font>xpos<font color="#000080">-</font>x<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font>gotoxy<font color="#000080">(</font>xpos<font color="#000080">,</font>ypos<font color="#000080">);
        </font>write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">);
        </font>input<font color="#000080">:=</font>venstre<font color="#000080">+</font>hoejre<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>gotoxy<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">); </font>clreol<font color="#000080">; </font>write<font color="#000080">(</font>input<font color="#000080">);
  </font><font color="#FF0000"><b>until</b></font><font color="#000080">(</font>ch<font color="#000080">=</font>kbenter<font color="#000080">)</font><font color="#FF0000"><b>or</b></font><font color="#000080">(</font>ch<font color="#000080">=</font>kbesc<font color="#000080">);
  </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ch<font color="#000080">=</font>kbesc<font color="#000080">)</font><font color="#FF0000"><b>then
  begin
    </b></font>getstring<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
    </font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>textattr<font color="#000080">:=</font>oldcol<font color="#000080">;
  </font>getstring<font color="#000080">:=</font>input<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>xorbar<font color="#000080">(</font>x1<font color="#000080">,</font>x2<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>c<font color="#000080">:</font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">dec [y]
  push colseg
  pop es
  mov di,[y]
  mov bx,di
  shl di,6
  shl bx,4
  add di,bx
  add di,[x1]
  shl di,1
  dec di
  mov cx,[x2]
  sub cx,[x1]
  inc cx
  @@loop:
    mov al,[c]
    xor es:[di],al
    add di,2
    dec cx
    jnz @@loop
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>selectbar<font color="#000080">(</font>xp<font color="#000080">,</font>yp<font color="#000080">,</font>x2<font color="#000080">,</font>num<font color="#000080">,</font>col<font color="#000080">,</font>ystart<font color="#000080">:</font>byte<font color="#000080">;</font>abort<font color="#000080">:</font>boolean<font color="#000080">):</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>ch<font color="#000080">:</font>char<font color="#000080">;
  </font>y<font color="#000080">,</font>oy<font color="#000080">:</font>byte<font color="#000080">;
  </font>done<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>selectbar<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>oy<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">; </font>y<font color="#000080">:=</font>ystart<font color="#000080">;
  </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>y<font color="#000080">&gt;</font>num<font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>done<font color="#000080">:=</font>false<font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    if</b></font><font color="#000080">(</font>y<font color="#000080">&lt;&gt;</font>oy<font color="#000080">)</font><font color="#FF0000"><b>then
    begin
      if</b></font><font color="#000080">(</font>oy<font color="#000080">&lt;&gt;</font><font color="#800000">255</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>xorbar<font color="#000080">(</font>xp<font color="#000080">,</font>x2<font color="#000080">,</font>pred<font color="#000080">(</font>oy<font color="#000080">+</font>yp<font color="#000080">),</font>col<font color="#000080">);
      </font>xorbar<font color="#000080">(</font>xp<font color="#000080">,</font>x2<font color="#000080">,</font>pred<font color="#000080">(</font>y<font color="#000080">+</font>yp<font color="#000080">),</font>col<font color="#000080">);
      </font>oy<font color="#000080">:=</font>y<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>ch<font color="#000080">:=</font>readkey<font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ch<font color="#000080">=</font>kbnull<font color="#000080">)</font><font color="#FF0000"><b>then
    begin
      </b></font>ch<font color="#000080">:=</font>readkey<font color="#000080">;
      </font><font color="#FF0000"><b>case </b></font>ch <font color="#FF0000"><b>of
        </b></font>kbleft<font color="#000080">,</font>kbup<font color="#000080">:</font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>y<font color="#000080">&gt;</font><font color="#800000">1</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>y<font color="#000080">);
        </font>kbright<font color="#000080">,</font>kbdown<font color="#000080">:</font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>y<font color="#000080">&lt;</font>num<font color="#000080">)</font><font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>y<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end else
    case </b></font>ch <font color="#FF0000"><b>of
      </b></font>kbenter<font color="#000080">:</font><font color="#FF0000"><b>begin </b></font>selectbar<font color="#000080">:=</font>succ<font color="#000080">(</font>y<font color="#000080">-</font>yp<font color="#000080">); </font>done<font color="#000080">:=</font>true<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>kbesc<font color="#000080">:</font><font color="#FF0000"><b>begin if</b></font><font color="#000080">(</font>abort<font color="#000080">)</font><font color="#FF0000"><b>then </b></font>done<font color="#000080">:=</font>true<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until</b></font><font color="#000080">(</font>done<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>selectfile<font color="#000080">(</font>wildcard<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>x<font color="#000080">,</font>y<font color="#000080">,</font>col<font color="#000080">:</font>byte<font color="#000080">;</font>abort<font color="#000080">:</font>boolean<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>wx1<font color="#000080">,</font>wy1<font color="#000080">,</font>wx2<font color="#000080">,</font>wy2<font color="#000080">:</font>byte<font color="#000080">; </font><font color="#008000"><i>{ Window dimensions. }
</i></font><font color="#FF0000"><b>begin
  </b></font>inilink<font color="#000080">(</font>dirlink<font color="#000080">);
  </font>selectfile<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font>findfirst<font color="#000080">(</font>wildcard<font color="#000080">,</font>archive<font color="#000080">,</font>dirinfo<font color="#000080">);
  </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>dirinfo<font color="#000080">.</font>name<font color="#000080">=</font><font color="#800000">''</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>while</b></font><font color="#000080">(</font>doserror<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>do
  begin
    </b></font>addlink2<font color="#000080">(</font>dirlink<font color="#000080">,</font>dirinfo<font color="#000080">.</font>name<font color="#000080">);
    </font>findnext<font color="#000080">(</font>dirinfo<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>writeln<font color="#000080">(</font>numlinks<font color="#000080">(</font>dirlink<font color="#000080">));
  </font>killink<font color="#000080">(</font>dirlink<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MENU SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0011.PAS">Original</a><b>]</b></p></body>
</html>

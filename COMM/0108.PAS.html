<html>
<head><title> "X00 Unit" by GORDON TACKETT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0108.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
 *  Interface unit for the X00 device driver. This unit supports all
 *  comm fossil calls needed to do most communication tasks.
 *
 *  Author  Gordon Tackett
 *  Date    01-31-91
 *
 *  $Revision:   1.0  $
}

{$IFDEF LOCAL}

</i></font><font color="#FF0000"><b>Program </b></font>X00<font color="#000080">;

</font><font color="#008000"><i>{$ELSE}

</i></font><font color="#FF0000"><b>Unit </b></font>X00<font color="#000080">;

</font><font color="#FF0000"><b>Interface

</b></font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">;


</font><font color="#FF0000"><b>Type

  </b></font><font color="#008000"><i>{
  * Driver Information Block.
  *    This record holds all of the current settings from the
  *    X00 driver after a call to funciton $1B
  }
  </i></font>DvrInfo <font color="#000080">= </font><font color="#FF0000"><b>Record
      </b></font>Size  <font color="#000080">: </font>Word<font color="#000080">;
      </font>Spec  <font color="#000080">: </font>byte<font color="#000080">;
      </font>Rev   <font color="#000080">: </font>Byte<font color="#000080">;
      </font>ID    <font color="#000080">: </font>Pointer<font color="#000080">;
      </font>Ibuf  <font color="#000080">: </font>Word<font color="#000080">;
      </font>Iavl  <font color="#000080">: </font>Word<font color="#000080">;
      </font>OBuf  <font color="#000080">: </font>Word<font color="#000080">;
      </font>Oavl  <font color="#000080">: </font>Word<font color="#000080">;
      </font>Width <font color="#000080">: </font>Byte<font color="#000080">;
      </font>Height<font color="#000080">: </font>Byte<font color="#000080">;
      </font>Baud  <font color="#000080">: </font>Byte<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#008000"><i>{
  * Timer Fuctions &amp; Pointers
  *    This procedure type is used to define a pointer the the procedure
  *    that may be sent to the X00 driver for calling during a timer
  *    tick. These procedures must be declared far
  }
  </i></font>TimerFunction <font color="#000080">= </font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">;
  </font>TimerFunctionPtr <font color="#000080">= ^</font>TimerFunction<font color="#000080">;


  </font><font color="#008000"><i>{
  *  X00 Driver object
  *    This is the main object for this module. It has all the interface
  *    routines and data needed to call all the major functions of the
  *    X00 device driver.
  }
  </i></font>X00Dvr <font color="#000080">= </font><font color="#FF0000"><b>Object
    </b></font>Port        <font color="#000080">: </font>Word<font color="#000080">;
    </font>Baud        <font color="#000080">: </font>Word<font color="#000080">;
    </font>Size        <font color="#000080">: </font>Word<font color="#000080">;
    </font>Parity      <font color="#000080">: </font>Char<font color="#000080">;
    </font>Stops       <font color="#000080">: </font>Word<font color="#000080">;
    </font>Status      <font color="#000080">: </font>Word<font color="#000080">;
    </font>MaxFuncs    <font color="#000080">: </font>Word<font color="#000080">;
    </font>RevLevel    <font color="#000080">: </font>Word<font color="#000080">;
    </font>CtrlCFlags  <font color="#000080">: </font>Byte<font color="#000080">;
    </font>CurInfo     <font color="#000080">: </font>DvrInfo<font color="#000080">;

    </font><font color="#FF0000"><b>Constructor </b></font>Init<font color="#000080">(</font>Prt<font color="#000080">,</font>Bd<font color="#000080">,</font>Sz <font color="#000080">: </font>Word<font color="#000080">; </font>Prty <font color="#000080">: </font>Char<font color="#000080">; </font>StpBts <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Function    </b></font>GetLastStatus <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetInfoSize <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetInfoSpec <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetInfoRev  <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetInfoId   <font color="#000080">: </font>Pointer<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetInfoIbuf <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetInfoIavl <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetInfoOBuf <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetInfoOAvl <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetInfoCrtW <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetInfoCrtH <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetInfoBaud <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetPort     <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetBaud     <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetSize     <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetParity   <font color="#000080">: </font>Char<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetStops    <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetMaxFuncs <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetRevLevel <font color="#000080">: </font>Word<font color="#000080">;

    </font><font color="#FF0000"><b>Procedure   </b></font>SetBaud<font color="#000080">(</font>Bd<font color="#000080">,</font>Sz <font color="#000080">: </font>Word<font color="#000080">; </font>Prty <font color="#000080">: </font>Char<font color="#000080">; </font>StpBts <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure   </b></font>TxChar<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
    </font><font color="#FF0000"><b>Function    </b></font>RxChar <font color="#000080">: </font>Char<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>GetStatus <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>InitFossil<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>DeinitFossil<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>DropDTR<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>RaseDTR<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>SystemTimerParams<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>TicksPerSec<font color="#000080">,</font>MsPerTick <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure   </b></font>FlushBuffer<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>PurgeOutputBuffer<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>PurgeInputBuffer<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>TxCharNoWait<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
    </font><font color="#FF0000"><b>Function    </b></font>RXPeekChar<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Ch <font color="#000080">: </font>Char<font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>KBPeekChar<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Ch <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>KBRead <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>FlowControl<font color="#000080">(</font>XONCTS <font color="#000080">: </font>Byte<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure   </b></font>CtrlCChkOn<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>CtrlCChkOff<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>XmitOff<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>XmitOn<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>GotoXY<font color="#000080">(</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure   </b></font>GetCursorLoc<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure   </b></font>AnsiWriteChar<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure   </b></font>EnableWatchDog<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>DisableWatchDog<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>WriteChar<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
    </font><font color="#FF0000"><b>Function    </b></font>InsertTimerFunction<font color="#000080">(</font>TF <font color="#000080">: </font>TimerFunctionPtr<font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>Function    </b></font>DeleteTimerFunction<font color="#000080">(</font>TF <font color="#000080">: </font>TimerFunctionPtr<font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>Reboot<font color="#000080">(</font>Tp <font color="#000080">: </font>Boolean<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure   </b></font>RecvBuffer<font color="#000080">(</font>Buffer <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Sz <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure   </b></font>SendBuffer<font color="#000080">(</font>Buffer <font color="#000080">: </font>Pointer<font color="#000080">; </font>Sz <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure   </b></font>StopBreak<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure   </b></font>GetInfo<font color="#000080">;
    </font><font color="#008000"><i>{7e}
    {7f}
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Const
  </b></font>OutputBuffEmpty    <font color="#000080">= </font><font color="#800000">$4000</font><font color="#000080">;
  </font>OutputBuffNotFull  <font color="#000080">= </font><font color="#800000">$2000</font><font color="#000080">;
  </font>InputBuffOverrun   <font color="#000080">= </font><font color="#800000">$0200</font><font color="#000080">;
  </font>CharInInputBuff    <font color="#000080">= </font><font color="#800000">$0100</font><font color="#000080">;
  </font>CarrierDetect      <font color="#000080">= </font><font color="#800000">$0080</font><font color="#000080">;
  </font>TxXonXoff          <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;
  </font>TXCts              <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;
  </font>RxXonXoff          <font color="#000080">= </font><font color="#800000">$03</font><font color="#000080">;




</font><font color="#FF0000"><b>Var
  </b></font>Comm1 <font color="#000080">: </font>X00Dvr<font color="#000080">;
  </font>Comm2 <font color="#000080">: </font>X00Dvr<font color="#000080">;


</font><font color="#008000"><i>{$IFNDEF LOCAL}

</i></font><font color="#FF0000"><b>Implementation

</b></font><font color="#008000"><i>{$ENDIF}


</i></font><font color="#FF0000"><b>Var
  </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">; </font><font color="#008000"><i>{ register structure used in X00 calls}

</i></font><font color="#FF0000"><b>Const
  </b></font>CommVect <font color="#000080">= </font><font color="#800000">$14</font><font color="#000080">;          </font><font color="#008000"><i>{X00 interrupt vector}


{
*  Init - set up object and init port.
* This routine will clear unused bytes to 0 and will init the
* X00 fossil driver to the baud,size,parity,and stops as needed
* by the user application.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Constructor </b></font>X00Dvr<font color="#000080">.</font>Init<font color="#000080">(</font>Prt<font color="#000080">,</font>Bd<font color="#000080">,</font>Sz <font color="#000080">: </font>Word<font color="#000080">; </font>Prty <font color="#000080">: </font>Char<font color="#000080">; </font>StpBts <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    </b></font>Port <font color="#000080">:= </font>Prt<font color="#000080">;
    </font>CtrlCFlags <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>InitFossil<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>MaxFuncs <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>SetBaud<font color="#000080">(</font>Bd<font color="#000080">,</font>Sz<font color="#000080">,</font>Prty<font color="#000080">,</font>StpBts<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Last Status
*
* Interface function to get a copy of the status word storied in the
* object body.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetLastStatus <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetLastStatus <font color="#000080">:= </font>Status<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Information Size
*
* Interface function to get a copy of the word size from the info block.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetInfoSize <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetInfoSize <font color="#000080">:= </font>CurInfo<font color="#000080">.</font>Size<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Information Specification
*
* Interface function to get a copy of the fossil interface spec supported
* by this driver.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetInfoSpec <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetInfoSpec <font color="#000080">:= </font>CurInfo<font color="#000080">.</font>Spec<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Information Revision
*
* Interface function to get a copy of the fossil document revision supported
* by this driver.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetInfoRev <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetInfoRev <font color="#000080">:= </font>CurInfo<font color="#000080">.</font>Rev<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Information ID
*
* Interface function to get a copy of the pointer to the ascii
* string containing the name of the driver.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetInfoId <font color="#000080">: </font>Pointer<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetInfoId <font color="#000080">:= </font>CurInfo<font color="#000080">.</font>Id<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Information Input Buffer Size
*
* Interface function to get a copy of the size of the input buffer
* in bytes.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetInfoIbuf <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetInfoIBuf <font color="#000080">:= </font>CurInfo<font color="#000080">.</font>IBuf<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#008000"><i>{
* Get Information Input Buffer Avaliable
*
* Interface function to get a copy of the amount of input buffer that is
* avaliable for use.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetInfoIavl <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetInfoIavl <font color="#000080">:= </font>CurInfo<font color="#000080">.</font>Iavl<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Information Output Buffer Size
*
* Interface function to get a copy of the size of the output buffer
* in bytes.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetInfoOBuf <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetInfoOBuf <font color="#000080">:= </font>CurInfo<font color="#000080">.</font>OBuf<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Information Output Buffer Avaliable
*
* Interface function to get a copy of the amount of Output buffer that is
* avaliable for use.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetInfoOAvl <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetInfoOAvl <font color="#000080">:= </font>CurInfo<font color="#000080">.</font>OAvl<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{
* Get Information Current CRT Width
*
* Interface function to get a copy of the width of the CRT
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetInfoCrtW <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetInfoCrtW <font color="#000080">:= </font>CurInfo<font color="#000080">.</font>Width<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Information Current CRT Height
*
* Interface funciton to get a copy of the height of the CRT
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetInfoCrtH <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetInfoCrtH <font color="#000080">:= </font>CurInfo<font color="#000080">.</font>Height<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Information Current Baud Rate
*
* Interface function to get a copy of the current baud rate as returned
* in the curinfo structure.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetInfoBaud <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetInfoBaud <font color="#000080">:= </font>CurInfo<font color="#000080">.</font>Baud<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get the port number
*
* Interface function to return the port number that was used to call
* the constructor Init. Once this constructor is called the port value
* can't be changed.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetPort <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetPort <font color="#000080">:= </font>Port<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get the Baud Rate
*
* Interface function that is used to get the last baud rate sent to
* this object from an application. This may not be the current correct
* baud rate.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetBaud <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetBaud <font color="#000080">:= </font>Baud<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get the Word Size
*
* Interface function that is used to get the last word size sent to
* this object from an application. This is always correct
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetSize <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetSize <font color="#000080">:= </font>Size<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get the Parity
*
* Interface function that is used to get the last parity value that was
* sent to this object from an application. this is always correct.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetParity <font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetParity <font color="#000080">:= </font>Parity<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;




</font><font color="#008000"><i>{
* Get Stop Bits
*
* Interface function that is used to get the last number of stop bits
* that was sent to this object from an application. This is always correct.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetStops <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetStops <font color="#000080">:= </font>Stops<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;




</font><font color="#008000"><i>{
* Get Maximum Function
*
* Interface function to return the maximum functions supported
* by this fossil driver.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetMaxFuncs <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetMaxFuncs <font color="#000080">:= </font>MaxFuncs<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Fossil Rev
*
* Interface function to return the revision level of the fossil
* that is in use.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>GetRevLevel <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>GetRevLevel <font color="#000080">:= </font>RevLevel<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Set Baud Rate
*
* BaudRate code in AL:
* Bits [7:5] 000 = 19200, 001 = 38400, 010 = 300, 011 = 600, 100 = 1200,
* 101 = 2400, 110 = 4800, 111 = 9600. Parity: [4:3] 00 or 10 = none,
* 01 = odd, 11 = even. StopBits: [2:2] 0 = 1, 1 = 2
* CharLength: 5 bits plus value [1:0] Support for [4:0] = 00011 required of
* driver, others optional
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>SetBaud<font color="#000080">(</font>Bd<font color="#000080">,</font>Sz <font color="#000080">: </font>Word<font color="#000080">; </font>Prty <font color="#000080">: </font>Char<font color="#000080">; </font>StpBts <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>Bits <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>Baud <font color="#000080">:= </font>Bd<font color="#000080">;
    </font>Size <font color="#000080">:= </font>Sz<font color="#000080">;
    </font>Parity <font color="#000080">:= </font>Prty<font color="#000080">;
    </font>Stops <font color="#000080">:= </font>StpBts<font color="#000080">;

    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;

    </font><font color="#FF0000"><b>Case </b></font>Baud <font color="#FF0000"><b>of
        </b></font><font color="#800000">300 </font><font color="#000080">: </font>Bits <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
        </font><font color="#800000">600 </font><font color="#000080">: </font>Bits <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
       </font><font color="#800000">1200 </font><font color="#000080">: </font>Bits <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
       </font><font color="#800000">2400 </font><font color="#000080">: </font>Bits <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
       </font><font color="#800000">4800 </font><font color="#000080">: </font>Bits <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
       </font><font color="#800000">9600 </font><font color="#000080">: </font>Bits <font color="#000080">:= </font><font color="#800000">7</font><font color="#000080">;
      </font><font color="#800000">19200 </font><font color="#000080">: </font>Bits <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#800000">38400 </font><font color="#000080">: </font>Bits <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>Else
      </b></font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font>Bits <font color="#000080">:= </font>Bits <font color="#FF0000"><b>Shl </b></font><font color="#800000">2</font><font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>Parity <font color="#000080">= </font><font color="#800000">'E' </font><font color="#FF0000"><b>Then
      </b></font>Bits <font color="#000080">:= </font>Bits <font color="#000080">+ </font><font color="#800000">3
    </font><font color="#FF0000"><b>Else if </b></font>Parity <font color="#000080">= </font><font color="#800000">'O' </font><font color="#FF0000"><b>Then

</b></font><font color="#008000"><i>{  c&frac34;&icirc;&ordm;D‘B6&acute;= Bits + 1;}

    </i></font>Bits <font color="#000080">:= </font>Bits <font color="#FF0000"><b>Shl </b></font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>Stops <font color="#000080">= </font><font color="#800000">2 </font><font color="#FF0000"><b>then
      </b></font>Bits <font color="#000080">:= </font>Bits <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font>Bits <font color="#000080">:= </font>Bits <font color="#FF0000"><b>Shl </b></font><font color="#800000">2</font><font color="#000080">;
    </font><font color="#FF0000"><b>Case </b></font>Size <font color="#FF0000"><b>Of
      </b></font><font color="#800000">6 </font><font color="#000080">: </font>Bits <font color="#000080">:= </font>Bits <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#800000">7 </font><font color="#000080">: </font>Bits <font color="#000080">:= </font>Bits <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">;
      </font><font color="#800000">8 </font><font color="#000080">: </font>Bits <font color="#000080">:= </font>Bits <font color="#000080">+ </font><font color="#800000">3</font><font color="#000080">;
    </font><font color="#FF0000"><b>Else
      </b></font>Bits <font color="#000080">:= </font>Bits <font color="#000080">+ </font><font color="#800000">3</font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font>Regs<font color="#000080">.</font>Al <font color="#000080">:= </font>Bits<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$00</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font>Status <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#008000"><i>{
* Transmit Character
*
* Character is queued for transmission. If there is room in the transmitter
* buffer when this call is made, the character will be stored and control
* returned to caller. If the buffer is full, the driver will wait for room.
* This can be dangerous when used in combination with flow control (see
* Function 0Fh)
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>TxChar<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    </b></font>Regs<font color="#000080">.</font>al <font color="#000080">:= </font>Ord<font color="#000080">(</font>Ch<font color="#000080">);
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font>Status <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Receive Character
*
* The next character in the input ring buffer is returned to the caller. If
* none available, the driver will wait for input.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function  </b></font>X00Dvr<font color="#000080">.</font>RxChar <font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font>RxChar <font color="#000080">:= </font>Char<font color="#000080">(</font>Regs<font color="#000080">.</font>Al<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Status
*
* Bits are:
* AH[6:6] 1 = Output buffer empty
* AH[5:5] 1 = Output buffer not full
* AH[1:1] 1 = Input buffer overrun
* AH[0:0] 1 = Characters in input buffer
* AL[7:7] 1 = Carrier Detect signal
* AL[3:3] 1 = Always (never 0)
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function  </b></font>X00Dvr<font color="#000080">.</font>GetStatus <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>REgs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$03</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font>GetStatus <font color="#000080">:= </font>Regs<font color="#000080">.</font>Ax<font color="#000080">;
    </font>Status <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Init Fossil Driver
*
* Required before I/O can take place on comm port.  When DX = 00FFh,  then
* any initialization needed to make the keyboard/display available for FOSSIL
* use should be performed.  BX = 4F50h signals that ES:CX points to a flag
* byte in the application that the driver should increment when its
* keyboard routines detect a Ctl-C.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>InitFossil<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$04</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>Bx <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>Regs<font color="#000080">.</font>Ax <font color="#000080">&lt;&gt; </font><font color="#800000">$1954 </font><font color="#FF0000"><b>Then
      Begin
        </b></font>MaxFuncs <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>RevLevel <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>End
    Else
      Begin
        </b></font>MaxFuncs <font color="#000080">:= </font>Regs<font color="#000080">.</font>Bl<font color="#000080">;
        </font>RevLevel <font color="#000080">:= </font>Regs<font color="#000080">.</font>Bh<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* De-Init Fossil Driver
*
* Disengages driver from comm port. Should be done when operations on the
* port are complete.  IF DX = 00FFh, then the initialization that was
* performed when FOSSIL function 04h with DX = 00FFh should be undone.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>DeinitFossil<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$05 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$05</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{
* Drop Dtr Line
*
* Used to control Data Terminal Ready signal line on com port. This line
* usually has some effect on modem operation (most modems will drop
* carrier if DTR is lowered, for example).
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>DropDTR<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$06 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$06</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>Al <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#008000"><i>{
* Rase Dtr Line
*
* Used to control Data Terminal Ready signal line on com port. This line
* usually has some effect on modem operation (most modems will drop
* carrier if DTR is lowered, for example).
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>RaseDTR<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$06 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$06</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>Al <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get System Timming Parameters
*
* Returns statistics needed to do some critical timing in any MS-DOS system.
* The interrupt number in AL can be used to intercept a timer interrupt
* that happens (AH) times per second. DX is essentially 1000/AH. Function
* 16h is the preferred way to install timer tick code. AH and DX should
* be accurate for the 16h timer tick.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>SystemTimerParams<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>TicksPerSec<font color="#000080">,</font>MsPerTick <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$07 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$07</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font>TicksPerSec <font color="#000080">:= </font>Regs<font color="#000080">.</font>Ah<font color="#000080">;
    </font>MsPerTick <font color="#000080">:= </font>Regs<font color="#000080">.</font>Dx<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Flush Output Buffer
*
* This is used to wait for all output to complete. If flow control is active
* it is possible for this code never to return control to the caller. (See
* function 0Fh)
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>FlushBuffer<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$08 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$08</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Purge Output Buffer
*
* Zero the output buffer. Returns to the caller immediately. Characters
* that have not been transmitted yet are lost.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>PurgeOutputBuffer<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$09 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$09</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Purge Input Buffer
*
* Zeroes the input buffer. If any flow control restraint has been employed
* (dropping RTS or transmitting XOFF) the port will be &quot;released&quot; (by doing
* the reverse, raising RTS or sending XON). Returns to caller immediately.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>PurgeInputBuffer<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$0A </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$0A</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Transmit Character without wait
*
* Character is queued for transmission. If there is room in the transmitter
* buffer when this call is made, the character will be stored and control
* returned to caller with AX=1. If the buffer is full, control is returned
* to caller with AX=0. This allows the application to make its own decisions
* on how to deal with &quot;buffer full&quot;.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>TxCharNoWait<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    Repeat
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$0B </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
      </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
      </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$0B</font><font color="#000080">;
      </font>Regs<font color="#000080">.</font>Al <font color="#000080">:= </font>Ord<font color="#000080">(</font>Ch<font color="#000080">);
      </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>Regs<font color="#000080">.</font>Ax <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Keyboard Peek Character
*
* The next character in the input ring buffer is returned to the caller. If
* none available, the driver returns a value of FFFFH. This &quot;read&quot; does not
* actually remove a character from the input buffer!
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function  </b></font>X00Dvr<font color="#000080">.</font>RXPeekChar<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Ch <font color="#000080">: </font>Char<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$0C </font><font color="#FF0000"><b>Then
      </b></font>c<font color="#000080">&frac34;&icirc;&ordm;</font>D<font color="#000080">‘</font>B6Q<font color="#000080">|   </font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0C</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font>Ch <font color="#000080">:= </font>Char<font color="#000080">(</font>Regs<font color="#000080">.</font>AL<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>Regs<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">$FFFF </font><font color="#FF0000"><b>Then
        </b></font>RxPeekChar <font color="#000080">:= </font>False
    <font color="#FF0000"><b>Else
        </b></font>RxPeekChar <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Keyboard Peek Character
*
* The next character in the keyboard buffer is returned to the caller. If
* none available, the driver returns a value of FFFFH. This &quot;read&quot; does not
* actually remove a character from the input buffer! For function keys, IBM
* PC scan codes must be returned.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function  </b></font>X00Dvr<font color="#000080">.</font>KBPeekChar<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Ch <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$0D </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0D</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font>Ch <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>Regs<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">$FFFF </font><font color="#FF0000"><b>Then
        </b></font>KBPeekChar <font color="#000080">:= </font>False
    <font color="#FF0000"><b>Else
        </b></font>KBPeekChar <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Keyboard Read Character
*
* Return the next character from the keyboard buffer. Wait for a keystroke
* if the buffer is empty. For function keys, IBM PC scan codes are required.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>KBRead <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$0E </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0E</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font>KBRead <font color="#000080">:= </font>Regs<font color="#000080">.</font>AX<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Flow Control
*
* AL[0:0] 1= enables remote to restrain FOSSIL transmitter using XON/XOFF;
* AL[1:1] 1= enables modem restraint of FOSSIL transmitter using CTS and
*            FOSSIL restraint of modem using RTS
* AL[3:3] 1= enables FOSSIL to restrain remote using XON/XOFF.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>FlowControl<font color="#000080">(</font>XONCTS <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$0F </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$0F</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>Al <font color="#000080">:= </font>XonCTS<font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Ctrl C Checking On
*
* AL[0:0] 1 = enable/disable CtlC/CtlK check (driver will set internal flag
*             which is returned by this function when it detects a CtlC/CtlK).
* AL[1:1] 1 = stop transmitter
*         0 = release previous stop
*             This is used primarily for programs that can't trust XON/XOFF
*             at FOSSIL level (such as BBS software).
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>CtrlCChkOn<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$10 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$10</font><font color="#000080">;
    </font>CtrlCFlags <font color="#000080">:= </font>CtrlCFlags <font color="#FF0000"><b>Or </b></font><font color="#800000">1</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>CtrlCFlags<font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Ctrl C Checking Off
*
* AL[0:0] 1 = enable/disable CtlC/CtlK check (driver will set internal flag
*             which is returned by this function when it detects a CtlC/CtlK).
* AL[1:1] 1 = stop transmitter
*         0 = release previous stop
*             This is used primarily for programs that can't trust XON/XOFF
*             at FOSSIL level (such as BBS software).
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>CtrlCChkOff<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$10 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$10</font><font color="#000080">;
    </font>CtrlCFlags <font color="#000080">:= </font>CtrlCFlags <font color="#FF0000"><b>And Not </b></font><font color="#800000">1</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>CtrlCFlags<font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Transmitter On
*
* AL[0:0] 1 = enable/disable CtlC/CtlK check (driver will set internal flag
*             which is returned by this function when it detects a CtlC/CtlK).
* AL[1:1] 1 = stop transmitter
*         0 = release previous stop
*             This is used primarily for programs that can't trust XON/XOFF
*             at FOSSIL level (such as BBS software).
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>XmitOn<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$10 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$10</font><font color="#000080">;
    </font>CtrlCFlags <font color="#000080">:= </font>CtrlCFlags <font color="#FF0000"><b>And Not </b></font><font color="#800000">2</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>CtrlCFlags<font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

--- </font>FD <font color="#800000">1.99</font>c
 <font color="#000080">* </font>Origin<font color="#000080">: </font><font color="#FF0000"><b>If </b></font>you clone around you<font color="#800000">'ll end up talking to yourself! (1:105/324.1)

</font><font color="#000080">&Auml; </font>Turbo <font color="#FF0000"><b>Pascal </b></font><font color="#000080">&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml; </font><font color="#FF0000"><b>PASCAL </b></font><font color="#000080">&Auml;
</font>Msg  <font color="#000080">: </font><font color="#800000">351 </font><font color="#FF0000"><b>of </b></font><font color="#800000">400                                                               
</font>From <font color="#000080">: </font>Gordon Tackett                      <font color="#800000">1</font><font color="#000080">:</font><font color="#800000">105</font><font color="#000080">/</font><font color="#800000">324.1          01 </font>Apr <font color="#800000">91  10</font><font color="#000080">:</font><font color="#800000">44 
</font><font color="#FF0000"><b>To   </b></font><font color="#000080">: </font>Roland Frederic                     <font color="#800000">2</font><font color="#000080">:</font><font color="#800000">292</font><font color="#000080">/</font><font color="#800000">500.0                           
</font>Subj <font color="#000080">: </font>BBS <font color="#FF0000"><b>Program in </b></font>TP<font color="#000080">. </font>Part <font color="#800000">5 </font><font color="#FF0000"><b>of </b></font><font color="#800000">5                                         
</font><font color="#000080">&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;
</font><font color="#008000"><i>{
* Transmitter Off
*
* AL[0:0] 1 = enable/disable CtlC/CtlK check (driver will set internal flag
*             which is returned by this function when it detects a CtlC/CtlK).
* AL[1:1] 1 = stop transmitter
*         0 = release previous stop
*             This is used primarily for programs that can't trust XON/XOFF
*             at FOSSIL level (such as BBS software).
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>XmitOff<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$10 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$10</font><font color="#000080">;
    </font>CtrlCFlags <font color="#000080">:= </font>CtrlCFlags <font color="#FF0000"><b>Or </b></font><font color="#800000">2</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>CtrlCFlags<font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Goto XY
*
* Identical to IBM PC BIOS INT 10h, subfunction 02h. FOSSIL should do
* sanity checks but software should not assume that that is the case.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure  </b></font>X00Dvr<font color="#000080">.</font>GotoXY<font color="#000080">(</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$11 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dh <font color="#000080">:= </font>Lo<font color="#000080">(</font>Y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
    </font>Regs<font color="#000080">.</font>Dl <font color="#000080">:= </font>Lo<font color="#000080">(</font>X<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$11</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Cursor Location
*
* Identical to IBM PC BIOS INT 10h, subfunction 03h.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure  </b></font>X00Dvr<font color="#000080">.</font>GetCursorLoc<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$12 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$12</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font>Y <font color="#000080">:= </font>Regs<font color="#000080">.</font>Dh <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font>X <font color="#000080">:= </font>Regs<font color="#000080">.</font>Dl <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Ansi Write Character
*
* ANSI processing is a requirement of this call. It therefore should not be
* considered re-entrant, since DOS might be used (via ANSI.SYS)
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>AnsiWriteChar<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$13 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Al <font color="#000080">:= </font>Ord<font color="#000080">(</font>Ch<font color="#000080">);
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Enable Watch Dog
*
* FOSSIL will force the system to reboot if Carrier Detect on the specified
* port drops while &quot;watchdog&quot; is ON. It is not necessary for the port to
* be &quot;active&quot; (Function 04h) for this function to be used.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>EnableWatchDog<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$14 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$14</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* disable Watch Dog
*
* FOSSIL will force the system to reboot if Carrier Detect on the specified
* port drops while &quot;watchdog&quot; is ON. It is not necessary for the port to
* be &quot;active&quot; (Function 04h) for this function to be used.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>DisableWatchDog<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$14 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$14</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Write Character
*
* Write character to screen using re-entrant code. ANSI processing may
* not be assumed. This call may be used by DOS device drivers.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure  </b></font>X00Dvr<font color="#000080">.</font>WriteChar<font color="#000080">(</font>Ch <font color="#000080">: </font>Char<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$15 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font>Ord<font color="#000080">(</font>Ch<font color="#000080">);
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$15</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Insert Timer Function
*
* Allows FOSSIL to manage timer tick chain, which provides some measure of
* security over just snagging the interrupt. Use &quot;insert&quot; instead of
* grabbing the vector and &quot;remove&quot; in place of restoring it.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>InsertTimerFunction<font color="#000080">(</font>TF <font color="#000080">: </font>TimerFunctionPtr<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$16 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$16</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>TF<font color="#000080">^);
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Ofs<font color="#000080">(</font>TF<font color="#000080">^);
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>Regs<font color="#000080">.</font>Ax <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
        </b></font>InsertTimerFunction <font color="#000080">:= </font>True
    <font color="#FF0000"><b>Else
        </b></font>InsertTimerFunction <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Function </b></font>X00Dvr<font color="#000080">.</font>DeleteTimerFunction<font color="#000080">(</font>TF <font color="#000080">: </font>TimerFunctionPtr<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>I<font color="#000080">„&Icirc;&icirc;&ordm;</font>D<font color="#000080">‘</font>B6<font color="#000080">&ntilde;</font><font color="#800000">9 </font><font color="#000080">&lt; </font><font color="#800000">$16 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$16</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>AL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>TF<font color="#000080">^);
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Ofs<font color="#000080">(</font>TF<font color="#000080">^);
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>Regs<font color="#000080">.</font>Ax <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
        </b></font>DeleteTimerFunction <font color="#000080">:= </font>True
    <font color="#FF0000"><b>Else
        </b></font>DeleteTimerFunction <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Reboot
*
* Provides a machine-independent way for a &quot;troubled&quot; application to reset
* the system. Some machines may not support both &quot;flavors&quot; of bootstrap,
* in which case the setting of AL will not have any effect.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure  </b></font>X00Dvr<font color="#000080">.</font>Reboot<font color="#000080">(</font>Tp <font color="#000080">: </font>Boolean<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$17 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$17</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>Al <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>Tp <font color="#FF0000"><b>Then
      </b></font>Regs<font color="#000080">.</font>Al <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'System Error - Unable to ReBoot'</font><font color="#000080">);
    </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>True<font color="#000080">) </font><font color="#FF0000"><b>Do</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Receive Buffer
*
* Transfer as many characters as are available into the specified user
* buffer, up to the maximum specified in CX. ES and DI will not be modified
* by this call. The actual number of characters transferred will be in AX.
* This function does not wait for more characters to become available if the
* number in CX exceeds the number of characters currently stored.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>RecvBuffer<font color="#000080">(</font>Buffer <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Sz <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$18 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Self<font color="#000080">.</font>GetStatus <font color="#FF0000"><b>And </b></font><font color="#800000">$0100</font><font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
      Begin
        </b></font>Size <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>Buffer<font color="#000080">^);
    </font>Regs<font color="#000080">.</font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Buffer<font color="#000080">^);
    </font>Regs<font color="#000080">.</font>Cx <font color="#000080">:= </font>Sz<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$18</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font>Size <font color="#000080">:= </font>Regs<font color="#000080">.</font>Ax<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Send Buffer
*
* Transfer as many characters as will fit, from the specified user buffer
* into the output buffer, up to the maximum specified in CX. ES and DI
* will not be modified by this call. The actual number of characters
* transferred will be in AX.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>SendBuffer<font color="#000080">(</font>Buffer <font color="#000080">: </font>Pointer<font color="#000080">; </font>Sz <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>Cptr   <font color="#000080">: ^</font>Char<font color="#000080">;
    </font>I     <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$19 </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Cptr  <font color="#000080">:= </font>Buffer<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>Buffer<font color="#000080">^);
    </font>Regs<font color="#000080">.</font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Buffer<font color="#000080">^);
    </font>Regs<font color="#000080">.</font>Cx <font color="#000080">:= </font>Sz<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$19</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>Regs<font color="#000080">.</font>Ax <font color="#000080">&lt;&gt; </font>Sz <font color="#FF0000"><b>Then
      Begin
        </b></font>Regs<font color="#000080">.</font>Di <font color="#000080">:= </font>Regs<font color="#000080">.</font>Di <font color="#000080">+ </font>Regs<font color="#000080">.</font>Ax<font color="#000080">;
        </font>Cptr <font color="#000080">:= </font>Ptr<font color="#000080">(</font>Regs<font color="#000080">.</font>Es<font color="#000080">, </font>Regs<font color="#000080">.</font>Di<font color="#000080">);
        </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font>Regs<font color="#000080">.</font>Ax <font color="#FF0000"><b>To </b></font>Sz <font color="#FF0000"><b>Do
          Begin
            </b></font>Self<font color="#000080">.</font>TxChar<font color="#000080">(</font>Cptr<font color="#000080">^);
            </font>Cptr <font color="#000080">:= </font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>Cptr<font color="#000080">^),</font>Ofs<font color="#000080">(</font>Cptr<font color="#000080">^) + </font><font color="#800000">1</font><font color="#000080">);
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Stop Break
*
* Used for special applications such as certain high speed modems. Resets
* all transmit flow control restraints (such as an XOFF received from remote)
* Init (Function 4) or UnInit (Function 5) will stop an in-progress Break.
* Note: the application must determine the &quot;length&quot; of the BREAK.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>StopBreak<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$1A </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$1A</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>Al <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Send Break
*
* Used for special applications such as certain high speed modems. Resets
* all transmit flow control restraints (such as an XOFF received from remote)
* Init (Function 4) or UnInit (Function 5) will stop an in-progress Break.
* Note: the application must determine the &quot;length&quot; of the BREAK.
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>X00Dvr<font color="#000080">.</font>SendBreak<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$1A </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ah <font color="#000080">:= </font><font color="#800000">$1A</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>Al <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
* Get Info Block
*
* Get The Info Block Record from Fossil to usable memory. An Info Block is:
*
* Offset 0 (word) = Structure size
*        2 (byte) = FOSSIL spec version
*        3 (byte) = Driver rev level
*        4 (dwrd) = Pointer to ASCII ID
*        8 (word) = Input buffer size
*       0A (word) = Bytes avail (input)
*       0C (word) = Output buffer size
*       0E (word) = Bytes avail (output)
*       10 (byte) = Screen width, chars
*       11 (byte) = Screen height, chars
*       12 (byte) = Baud rate mask
*                   (See call 00h)
-----------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure  </b></font>X00Dvr<font color="#000080">.</font>GetInfo<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>MaxFuncs <font color="#000080">&lt; </font><font color="#800000">$1B </font><font color="#FF0000"><b>Then
        </b></font>Exit<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Cx <font color="#000080">:= </font>Sizeof<font color="#000080">(</font>CurInfo<font color="#000080">);
    </font>Regs<font color="#000080">.</font>Es <font color="#000080">:= </font>Seg<font color="#000080">(</font>CurInfo<font color="#000080">);
    </font>Regs<font color="#000080">.</font>Di <font color="#000080">:= </font>Ofs<font color="#000080">(</font>CurInfo<font color="#000080">);
    </font>Regs<font color="#000080">.</font>Dx <font color="#000080">:= </font>Port<font color="#000080">;
    </font>Regs<font color="#000080">.</font>Ax <font color="#000080">:= </font><font color="#800000">$1B</font><font color="#000080">;
    </font>Intr<font color="#000080">(</font>CommVect<font color="#000080">,</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#008000"><i>{
*
*
* Used to install user appendages into the INT 14h dispatcher.  Appendage
* codes 80h - BF are supported.  Codes 80h - 83h are reserved.  The error
* return,  BH = 00h and AX = 1954h, should mean that another appendage
* has already been installed with the code specified in AL.  The appendage
* will be entered via a far call whenever INT 14h call is made with AL
* equal to the appendage code.  The appendage should return to the INT
* 14h dispatcher via a far return.  The INT 14h dispatcher should not modify
* any registers prior to making the far call to the appendage and after the
* appendage returns control to the dispatcher.
-----------------------------------------------------------------------------}
{7E}
{
*
*
* Used to remove a user appendage that was installed using function 7Fh. An
* error return means that either the entry point specified in ES:DX did
* not match the entry point currently in the dispatcher table for the code
* given in AL,  or that no entry for the code given in AL currently exits.
-----------------------------------------------------------------------------}

{7F}

{$IFDEF LOCAL}
</i></font><font color="#FF0000"><b>Var
  </b></font>t1<font color="#000080">,</font>t2<font color="#000080">,</font>t3 <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>Comm1<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">2400</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">'N'</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">.

--- </font>FD <font color="#800000">1.99</font>c
 <font color="#000080">* </font>Origin<font color="#000080">: </font><font color="#FF0000"><b>If </b></font>you clone around you<font color="#800000">'ll end up talking to yourself! (1:105/324.1)

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to COMM SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0108.PAS">Original</a><b>]</b></p></body>
</html>

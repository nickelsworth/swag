<html>
<head><title> "Complete Collection of Sorting units" by C.A.R. HOARE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0066.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
&gt; Can you show me any version of thew quick sort that you may have? I've
&gt; never seen it and never used it before. I always used an insertion sort
&gt; For anything that I was doing.

Here is one (long) non-recursive version, quite fast.
}

</i></font><font color="#FF0000"><b>Type
  </b></font>_Compare  <font color="#000080">= </font><font color="#FF0000"><b>Function</b></font><font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>A<font color="#000080">, </font>B<font color="#000080">) : </font>Boolean<font color="#000080">;</font><font color="#008000"><i>{ QuickSort Calls This }

{ --------------------------------------------------------------- }
{ QuickSort Algorithm by C.A.R. Hoare.  Non-Recursive adaptation  }
{ from &quot;ALGORITHMS + DATA STRUCTURES = ProgramS&quot; by Niklaus Wirth }
{ Prentice-Hall, 1976. Generalized For unTyped arguments.   }
{ --------------------------------------------------------------- }

</i></font><font color="#FF0000"><b>Procedure </b></font>QuickSort<font color="#000080">(</font>V      <font color="#000080">: </font>Pointer<font color="#000080">;   </font><font color="#008000"><i>{ To Array of Records }
                    </i></font>Cnt    <font color="#000080">: </font>Word<font color="#000080">;      </font><font color="#008000"><i>{ Record Count        }
                    </i></font>Len    <font color="#000080">: </font>Word<font color="#000080">;      </font><font color="#008000"><i>{ Record Length       }
                    </i></font>ALessB <font color="#000080">: </font>_Compare<font color="#000080">); </font><font color="#008000"><i>{ Compare Function    }

</i></font><font color="#FF0000"><b>Type
  </b></font>SortRec <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>Lt<font color="#000080">, </font>Rt <font color="#000080">: </font>Integer
  <font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>SortStak <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>SortRec<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>StkT<font color="#000080">,
  </font>StkM<font color="#000080">,
  </font>Ki<font color="#000080">, </font>Kj<font color="#000080">,
  </font>M       <font color="#000080">: </font>Word<font color="#000080">;
  </font>Rt<font color="#000080">, </font>Lt<font color="#000080">,
  </font>I<font color="#000080">, </font>J    <font color="#000080">: </font>Integer<font color="#000080">;
  </font>Ps      <font color="#000080">: ^</font>SortStak<font color="#000080">;
  </font>Pw<font color="#000080">, </font>Px  <font color="#000080">: </font>Pointer<font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>Push<font color="#000080">(</font>Left<font color="#000080">, </font>Right <font color="#000080">: </font>Integer<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>Ps<font color="#000080">^[</font>StkT<font color="#000080">].</font>Lt <font color="#000080">:= </font>Left<font color="#000080">;
    </font>Ps<font color="#000080">^[</font>StkT<font color="#000080">].</font>Rt <font color="#000080">:= </font>Right<font color="#000080">;
    </font>Inc<font color="#000080">(</font>StkT<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>Pop<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Left<font color="#000080">, </font>Right <font color="#000080">: </font>Integer<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>Dec<font color="#000080">(</font>StkT<font color="#000080">);
    </font>Left  <font color="#000080">:= </font>Ps<font color="#000080">^[</font>StkT<font color="#000080">].</font>Lt<font color="#000080">;
    </font>Right <font color="#000080">:= </font>Ps<font color="#000080">^[</font>StkT<font color="#000080">].</font>Rt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{QSort}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Cnt <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>V <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then
  begin
    </b></font>StkT <font color="#000080">:= </font>Cnt <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;    </font><font color="#008000"><i>{ Record Count - 1 }
    </i></font>Lt   <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;          </font><font color="#008000"><i>{ Safety Valve    }

    { We need a stack of Log2(n-1) entries plus 1 spare For safety }

    </i></font><font color="#FF0000"><b>Repeat
      </b></font>StkT <font color="#000080">:= </font>StkT <font color="#FF0000"><b>SHR </b></font><font color="#800000">1</font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>Lt<font color="#000080">);
    </font><font color="#FF0000"><b>Until </b></font>StkT <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ 1+Log2(n-1) }

    </i></font>StkM <font color="#000080">:= </font>Lt <font color="#000080">* </font>SizeOf<font color="#000080">(</font>SortRec<font color="#000080">) + </font>Len <font color="#000080">+ </font>Len<font color="#000080">; </font><font color="#008000"><i>{ Stack Size + 2 Records }

    </i></font>GetMem<font color="#000080">(</font>Ps<font color="#000080">, </font>StkM<font color="#000080">);   </font><font color="#008000"><i>{ Allocate Memory    }

    </i></font><font color="#FF0000"><b>if </b></font>Ps <font color="#000080">= </font><font color="#FF0000"><b>Nil Then
      </b></font>RunError<font color="#000080">(</font><font color="#800000">215</font><font color="#000080">); </font><font color="#008000"><i>{ Catastrophic Error }

    </i></font>Pw <font color="#000080">:= @</font>Ps<font color="#000080">^[</font>Lt<font color="#000080">];   </font><font color="#008000"><i>{ Swap Area Pointer  }
    </i></font>Px <font color="#000080">:= </font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>Pw<font color="#000080">^), </font>Ofs<font color="#000080">(</font>Pw<font color="#000080">^) + </font>Len<font color="#000080">); </font><font color="#008000"><i>{ Hold Area Pointer  }

    </i></font>Lt <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Rt <font color="#000080">:= </font>Cnt <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{ Initial Partition  }

    </i></font>Push<font color="#000080">(</font>Lt<font color="#000080">, </font>Rt<font color="#000080">);   </font><font color="#008000"><i>{ Push Entire Table  }

    </i></font><font color="#FF0000"><b>While </b></font>StkT <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Do
    begin  </b></font><font color="#008000"><i>{ QuickSort Main Loop }
      </i></font>Pop<font color="#000080">(</font>Lt<font color="#000080">, </font>Rt<font color="#000080">);   </font><font color="#008000"><i>{ Get Next Partition  }
      </i></font><font color="#FF0000"><b>Repeat
        </b></font>I <font color="#000080">:= </font>Lt<font color="#000080">; </font>J <font color="#000080">:= </font>Rt<font color="#000080">;  </font><font color="#008000"><i>{ Set Work Pointers }

        { Save Record at Partition Mid-Point in Hold Area }
        </i></font>M <font color="#000080">:= (</font>LongInt<font color="#000080">(</font>Lt<font color="#000080">) + </font>Rt<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
        </font>Move<font color="#000080">(</font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Ofs<font color="#000080">(</font>V<font color="#000080">^) + </font>M <font color="#000080">* </font>Len<font color="#000080">)^, </font>Px<font color="#000080">^, </font>Len<font color="#000080">);

        </font><font color="#008000"><i>{ Get Useful Offsets to speed loops }
        </i></font>Ki <font color="#000080">:= </font>I <font color="#000080">* </font>Len <font color="#000080">+ </font>Ofs<font color="#000080">(</font>V<font color="#000080">^);
        </font>Kj <font color="#000080">:= </font>J <font color="#000080">* </font>Len <font color="#000080">+ </font>Ofs<font color="#000080">(</font>V<font color="#000080">^);

        </font><font color="#FF0000"><b>Repeat
          </b></font><font color="#008000"><i>{ Find Left-Most Entry &gt;= Mid-Point Entry }
          </i></font><font color="#FF0000"><b>While </b></font>ALessB<font color="#000080">(</font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Ki<font color="#000080">)^, </font>Px<font color="#000080">^) </font><font color="#FF0000"><b>Do
          begin
            </b></font>Inc<font color="#000080">(</font>Ki<font color="#000080">, </font>Len<font color="#000080">);
            </font>Inc<font color="#000080">(</font>I<font color="#000080">)
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

          </font><font color="#008000"><i>{ Find Right-Most Entry &lt;= Mid-Point Entry }
          </i></font><font color="#FF0000"><b>While </b></font>ALessB<font color="#000080">(</font>Px<font color="#000080">^, </font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Kj<font color="#000080">)^) </font><font color="#FF0000"><b>Do
          begin
            </b></font>Dec<font color="#000080">(</font>Kj<font color="#000080">, </font>Len<font color="#000080">);
            </font>Dec<font color="#000080">(</font>J<font color="#000080">)
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

          </font><font color="#008000"><i>{ if I &gt; J, the partition has been exhausted }
          </i></font><font color="#FF0000"><b>if </b></font>I <font color="#000080">&lt;= </font>J <font color="#FF0000"><b>Then
          begin
            if </b></font>I <font color="#000080">&lt; </font>J <font color="#FF0000"><b>Then  </b></font><font color="#008000"><i>{ we have two Records to exchange }
            </i></font><font color="#FF0000"><b>begin
              </b></font>Move<font color="#000080">(</font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Ki<font color="#000080">)^, </font>Pw<font color="#000080">^, </font>Len<font color="#000080">);
              </font>Move<font color="#000080">(</font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Kj<font color="#000080">)^, </font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Ki<font color="#000080">)^, </font>Len<font color="#000080">);
              </font>Move<font color="#000080">(</font>Pw<font color="#000080">^, </font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>V<font color="#000080">^), </font>Kj<font color="#000080">)^, </font>Len<font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

            </font>Inc<font color="#000080">(</font>I<font color="#000080">);
            </font>Dec<font color="#000080">(</font>J<font color="#000080">);
            </font>Inc<font color="#000080">(</font>Ki<font color="#000080">, </font>Len<font color="#000080">);
            </font>Dec<font color="#000080">(</font>Kj<font color="#000080">, </font>Len<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ if I &lt;= J }
        </i></font><font color="#FF0000"><b>Until </b></font>I <font color="#000080">&gt; </font>J<font color="#000080">;  </font><font color="#008000"><i>{ Until All Swaps Done }

        { We now have two partitions.  At left are all Records }
        { &lt; X, and at right are all Records &gt; X.  The larger   }
        { partition is stacked and we re-partition the residue }
        { Until time to pop a deferred partition.              }

        </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>J <font color="#000080">- </font>Lt<font color="#000080">) &lt; (</font>Rt <font color="#000080">- </font>I<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font><font color="#008000"><i>{ Right-Most Partition is Larger }
        </i></font><font color="#FF0000"><b>begin
          if </b></font>I <font color="#000080">&lt; </font>Rt <font color="#FF0000"><b>Then
            </b></font>Push<font color="#000080">(</font>I<font color="#000080">, </font>Rt<font color="#000080">); </font><font color="#008000"><i>{ Stack Right Side }
          </i></font>Rt <font color="#000080">:= </font>J<font color="#000080">;    </font><font color="#008000"><i>{ Resume With Left }
        </i></font><font color="#FF0000"><b>end
        else  </b></font><font color="#008000"><i>{  Left-Most Partition is Larger }
        </i></font><font color="#FF0000"><b>begin
          if </b></font>Lt <font color="#000080">&lt; </font>J <font color="#FF0000"><b>Then
            </b></font>Push<font color="#000080">(</font>Lt<font color="#000080">, </font>J<font color="#000080">); </font><font color="#008000"><i>{ Stack Left Side   }
          </i></font>Lt <font color="#000080">:= </font>I<font color="#000080">;    </font><font color="#008000"><i>{ Resume With Right }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>Until </b></font>Lt <font color="#000080">&gt;= </font>Rt<font color="#000080">;  </font><font color="#008000"><i>{ QuickSort is now Complete }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>FreeMem<font color="#000080">(</font>Ps<font color="#000080">, </font>StkM<font color="#000080">);   </font><font color="#008000"><i>{ Free Stack and Work Areas }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{QSort}

{ ---------------------------   CUT  ----------------------------}
{
ALEXANDER CHRISTOV

 I don't know if code like this has been posted on this echo, but anyway here
it goes. It implements three different versions of Qsort which so far if the
fastest sorting algorithm known. However, it is not adequate For sorting File
Records. I've tested the routines and have worked With them For quite a While,
but don't trust me 8-) Murphy never sleeps 8-)
}

</i></font><font color="#FF0000"><b>Unit </b></font>SORT<font color="#000080">;
</font><font color="#008000"><i>{&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;}
{ Purpose  : Unit that implements a generic QSort(), similar to           }
{            the one in the standard C library.                           }
{ Author   : Alexander Christov                                           }
{ Notes    : Very instructive on the use of Pointers in TP.               }
{                                                                         }
{  Use freely.                                                            }
{                                                                         }
{&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;}
</i></font><font color="#FF0000"><b>Interface

Type </b></font>CmpFunc<font color="#000080">=</font><font color="#FF0000"><b>Function</b></font><font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>QSort<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>Elements<font color="#000080">,</font>Size<font color="#000080">:</font>Word<font color="#000080">;</font>GT<font color="#000080">:</font>CmpFunc<font color="#000080">);

</font><font color="#008000"><i>{ Base      - Pointer to the first element
  Elements  - Number of elements
  Size      - Size of an element in Bytes. Use SizeOf() if in doubt
  GT        - A Function of Type CmpFunc that compares the elements pointed
              to by the first and the second arguments and returns True
              if the first is greater than the second. GT = Greater Than
              8-)
}

{ Some commonly used CmpFunc }

</i></font><font color="#FF0000"><b>Function </b></font>bGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^Byte }
</i></font><font color="#FF0000"><b>Function </b></font>wGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^Word }
</i></font><font color="#FF0000"><b>Function </b></font>lGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^LongInt }
</i></font><font color="#FF0000"><b>Function </b></font>rGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^Real }

</i></font><font color="#FF0000"><b>Implementation
</b></font><font color="#008000"><i>{$F+}

</i></font><font color="#FF0000"><b>Type </b></font>Dummy<font color="#000080">=</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
     </font>pDummy<font color="#000080">=^</font>Dummy<font color="#000080">;


</font><font color="#008000"><i>{ Recursive Implementation }

</i></font><font color="#FF0000"><b>Procedure </b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>L<font color="#000080">,</font>R<font color="#000080">,</font>Size<font color="#000080">:</font>Word<font color="#000080">;</font>GT<font color="#000080">:</font>CmpFunc<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>I<font color="#000080">,</font>J<font color="#000080">:</font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>X<font color="#000080">:</font>Pointer<font color="#000080">;
 </font><font color="#FF0000"><b>Procedure </b></font>SwapElements<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Word<font color="#000080">);
 </font><font color="#FF0000"><b>Var </b></font>Tmp<font color="#000080">:</font>Pointer<font color="#000080">;
 </font><font color="#FF0000"><b>begin
  </b></font>GetMem<font color="#000080">(</font>Tmp<font color="#000080">,</font>Size<font color="#000080">);
  </font>Move<font color="#000080">(</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>El1<font color="#000080">*</font>Size<font color="#000080">],</font>Tmp<font color="#000080">^,</font>Size<font color="#000080">);
  </font>Move<font color="#000080">(</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>El2<font color="#000080">*</font>Size<font color="#000080">],</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>El1<font color="#000080">*</font>Size<font color="#000080">],</font>Size<font color="#000080">);
  </font>Move<font color="#000080">(</font>Tmp<font color="#000080">^,</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>El2<font color="#000080">*</font>Size<font color="#000080">],</font>Size<font color="#000080">);
  </font>FreeMem<font color="#000080">(</font>Tmp<font color="#000080">,</font>Size<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>I<font color="#000080">:=</font>L<font color="#000080">;
 </font>J<font color="#000080">:=</font>R<font color="#000080">;
 </font>GetMem<font color="#000080">(</font>X<font color="#000080">,</font>Size<font color="#000080">);
 </font>Move<font color="#000080">(</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[((</font>L<font color="#000080">+</font>R<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">)*</font>Size<font color="#000080">],</font>X<font color="#000080">^,</font>Size<font color="#000080">);
 </font><font color="#FF0000"><b>Repeat
  While </b></font>GT<font color="#000080">(</font>X<font color="#000080">,@</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>I<font color="#000080">*</font>Size<font color="#000080">]) </font><font color="#FF0000"><b>do </b></font>INC<font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font>GT<font color="#000080">(@</font>pDummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>J<font color="#000080">*</font>Size<font color="#000080">],</font>X<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>DEC<font color="#000080">(</font>J<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>I<font color="#000080">&lt;=</font>J <font color="#FF0000"><b>then begin
   if </b></font>I<font color="#000080">&lt;&gt;</font>J <font color="#FF0000"><b>then </b></font>SwapElements<font color="#000080">(</font>I<font color="#000080">,</font>J<font color="#000080">);
   </font>INC<font color="#000080">(</font>I<font color="#000080">);
   </font>DEC<font color="#000080">(</font>J<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Until </b></font>I<font color="#000080">&gt;</font>J<font color="#000080">;
 </font>FreeMem<font color="#000080">(</font>X<font color="#000080">,</font>Size<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>L<font color="#000080">&lt;</font>J <font color="#FF0000"><b>then </b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">,</font>L<font color="#000080">,</font>J<font color="#000080">,</font>Size<font color="#000080">,</font>GT<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>I<font color="#000080">&lt;</font>R <font color="#FF0000"><b>then </b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">,</font>I<font color="#000080">,</font>R<font color="#000080">,</font>Size<font color="#000080">,</font>GT<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>QSort<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>Elements<font color="#000080">,</font>Size<font color="#000080">:</font>Word<font color="#000080">;</font>GT<font color="#000080">:</font>CmpFunc<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>Elements<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>Size<font color="#000080">,</font>GT<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>bGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pByte<font color="#000080">=^</font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>bGt<font color="#000080">:=(</font>pByte<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pByte<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>wGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pWord<font color="#000080">=^</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>wGt<font color="#000080">:=(</font>pWord<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pWord<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>lGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pLongInt<font color="#000080">=^</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>lGt<font color="#000080">:=(</font>pLongInt<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pLongInt<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>rGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pReal<font color="#000080">=^</font>Real<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>rGt<font color="#000080">:=(</font>pReal<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pReal<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.



</font><font color="#008000"><i>{$A-,B-,D+,E-,F+,G+,I-,L+,N-,O+,P+,Q-,R-,S-,T-,V-,X+,Y+}
{ I don't know which settings are Really necessary For this Unit, but since
  I always work With the above, I'm including them to make sure the Unit
  compiles in your computer. The only critical ones (I Think) are R- and F+
}
</i></font><font color="#FF0000"><b>Unit </b></font>SORT<font color="#000080">;
</font><font color="#008000"><i>{&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;}
{ Purpose:   Unit that implements a generic QSort, similar to the         }
{            one in the standard C library, but a lot more general        }
{            This new version allows ordering of almost anything,         }
{            even structures whose elements are not contiguous in memory  }
{            or have strange mutual dependancies that don't allow &quot;happy  }
{            swapping&quot;. Obviously, this version is slower than the        }
{            previous one. if you won't be sorting Linked Lists or        }
{            Collections, use the previous one.                           }
{ Author   : Alexander Christov                                           }
{ Notes    : Very instructive on the use of Pointers in TP.               }
{            This version does not limit the number of elements to        }
{            65535 since the need not be contiguous.                      }
{                                                                         }
{    Use freely.                                                          }
{                                                                         }
{&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;}
</i></font><font color="#FF0000"><b>Interface

Type </b></font>CmpFunc<font color="#000080">=</font><font color="#FF0000"><b>Function</b></font><font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
     </font>AddrFunc<font color="#000080">=</font><font color="#FF0000"><b>Function</b></font><font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>Size<font color="#000080">,</font>N<font color="#000080">:</font>LongInt<font color="#000080">):</font>Pointer<font color="#000080">;
     </font>SwapProc<font color="#000080">=</font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">;</font>Size<font color="#000080">:</font>LongInt<font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>QSort<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;      </font><font color="#008000"><i>{ Pointer to the first element.
                                     if the user Writes his own GT, Addr and
                                     Swap, this isn't Really necessary.
                                   }
                </i></font>Elements<font color="#000080">:</font>LongInt<font color="#000080">;  </font><font color="#008000"><i>{ Total number of elements }
                </i></font>Size<font color="#000080">:</font>Word<font color="#000080">;         </font><font color="#008000"><i>{ Size of an element in Bytes }
                </i></font>GT<font color="#000080">:</font>CmpFunc<font color="#000080">;        </font><font color="#008000"><i>{ Comparing Function  }
                </i></font>Addr<font color="#000080">:</font>AddrFunc<font color="#000080">;     </font><font color="#008000"><i>{ Addressing Function }
                </i></font>Swap<font color="#000080">:</font>SwapProc<font color="#000080">);    </font><font color="#008000"><i>{ Swapping Function }

{
  GT        - A funcion of Type CmpFunc that compares the elements pointed
              to by its first and second arguments, and returns True if the
              first element is Greater Than the second one. This Unit defines
              some commonly used CmpFuncs:
                    bGT - Compares Bytes
                    wGT - Compares Words
                    lGT - Compares LongInts
                    rGT - Compares Reals

  Addr      - A Function that receives the index of an element and must
              return a Pointer to it.
              This Unit defines the Function
                   LinearAddr
              which can be used whenever the elements are located
              contiguously in memory.

  Swap      - A Procedure that swaps the elements pointed by its arguments.
                    DirectSwap
              is defined in the Unit, which can be used whenever the elements
              are mutually independent or no external processes are needed
              when swapping two elements
}

{ Commonly used CmpFuncs }

</i></font><font color="#FF0000"><b>Function </b></font>bGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^Byte }
</i></font><font color="#FF0000"><b>Function </b></font>wGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^Word }
</i></font><font color="#FF0000"><b>Function </b></font>lGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^LongInt }
</i></font><font color="#FF0000"><b>Function </b></font>rGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{ Compares ^Real }

</i></font><font color="#FF0000"><b>Function </b></font>LinearAddr<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>Size<font color="#000080">,</font>N<font color="#000080">:</font>LongInt<font color="#000080">):</font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>DirectSwap<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">;</font>Size<font color="#000080">:</font>LongInt<font color="#000080">);

</font><font color="#FF0000"><b>Implementation
</b></font><font color="#008000"><i>{$F+}

</i></font><font color="#FF0000"><b>Type </b></font>Dummy<font color="#000080">=</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
     </font>pDummy<font color="#000080">=^</font>Dummy<font color="#000080">;


</font><font color="#FF0000"><b>Var </b></font>X<font color="#000080">,</font>Middle<font color="#000080">:</font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>Procedure
</b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>L<font color="#000080">,</font>R<font color="#000080">:</font>LongInt<font color="#000080">;</font>Size<font color="#000080">:</font>Word<font color="#000080">;</font>GT<font color="#000080">:</font>CmpFunc<font color="#000080">;</font>Addr<font color="#000080">:</font>AddrFunc<font color="#000080">;</font>Swap<font color="#000080">:</font>SwapProc
<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>I<font color="#000080">,</font>J<font color="#000080">:</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>I<font color="#000080">:=</font>L<font color="#000080">;
 </font>J<font color="#000080">:=</font>R<font color="#000080">;
 </font>Move<font color="#000080">(</font>Addr<font color="#000080">(</font>Base<font color="#000080">,</font>Size<font color="#000080">,(</font>L<font color="#000080">+</font>R<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">)^,</font>Middle<font color="#000080">^,</font>Size<font color="#000080">);
 </font><font color="#FF0000"><b>Repeat
  While </b></font>GT<font color="#000080">(</font>Middle<font color="#000080">,</font>Addr<font color="#000080">(</font>Base<font color="#000080">,</font>Size<font color="#000080">,</font>I<font color="#000080">)) </font><font color="#FF0000"><b>do </b></font>INC<font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font>GT<font color="#000080">(</font>Addr<font color="#000080">(</font>Base<font color="#000080">,</font>Size<font color="#000080">,</font>J<font color="#000080">),</font>Middle<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>DEC<font color="#000080">(</font>J<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>I<font color="#000080">&lt;=</font>J <font color="#FF0000"><b>then begin
   if </b></font>I<font color="#000080">&lt;&gt;</font>J <font color="#FF0000"><b>then </b></font>Swap<font color="#000080">(</font>Addr<font color="#000080">(</font>Base<font color="#000080">,</font>Size<font color="#000080">,</font>I<font color="#000080">),</font>Addr<font color="#000080">(</font>Base<font color="#000080">,</font>Size<font color="#000080">,</font>J<font color="#000080">),</font>Size<font color="#000080">);
   </font>INC<font color="#000080">(</font>I<font color="#000080">);
   </font>DEC<font color="#000080">(</font>J<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Until </b></font>I<font color="#000080">&gt;</font>J<font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>L<font color="#000080">&lt;</font>J <font color="#FF0000"><b>then </b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">,</font>L<font color="#000080">,</font>J<font color="#000080">,</font>Size<font color="#000080">,</font>GT<font color="#000080">,</font>Addr<font color="#000080">,</font>Swap<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>I<font color="#000080">&lt;</font>R <font color="#FF0000"><b>then </b></font>_Sort<font color="#000080">(</font>Base<font color="#000080">,</font>I<font color="#000080">,</font>R<font color="#000080">,</font>Size<font color="#000080">,</font>GT<font color="#000080">,</font>Addr<font color="#000080">,</font>Swap<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>QSort<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>GetMem<font color="#000080">(</font>X<font color="#000080">,</font>Size<font color="#000080">);  </font><font color="#008000"><i>{ &lt;- Made in Arturo Ramirez 8-) }
 </i></font>GetMem<font color="#000080">(</font>Middle<font color="#000080">,</font>Size<font color="#000080">);
 </font>_Sort<font color="#000080">(</font>Base<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>Elements<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>Size<font color="#000080">,</font>GT<font color="#000080">,</font>Addr<font color="#000080">,</font>Swap<font color="#000080">);
 </font>FreeMem<font color="#000080">(</font>X<font color="#000080">,</font>Size<font color="#000080">);
 </font>FreeMem<font color="#000080">(</font>Middle<font color="#000080">,</font>Size<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>bGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pByte<font color="#000080">=^</font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>bGt<font color="#000080">:=(</font>pByte<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pByte<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>wGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pWord<font color="#000080">=^</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>wGt<font color="#000080">:=(</font>pWord<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pWord<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>lGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pLongInt<font color="#000080">=^</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>lGt<font color="#000080">:=(</font>pLongInt<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pLongInt<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>rGT<font color="#000080">(</font>El1<font color="#000080">,</font>El2<font color="#000080">:</font>Pointer<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>pReal<font color="#000080">=^</font>Real<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>rGt<font color="#000080">:=(</font>pReal<font color="#000080">(</font>El1<font color="#000080">)^&gt;</font>pReal<font color="#000080">(</font>El2<font color="#000080">)^);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Linear Addressing }

</i></font><font color="#FF0000"><b>Function </b></font>LinearAddr<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>LinearAddr<font color="#000080">:=@</font>pdummy<font color="#000080">(</font>Base<font color="#000080">)^[</font>N<font color="#000080">*</font>Size<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Direct swapping of elements. With the use of Addr() it is quite more
 legible 8-) }

</i></font><font color="#FF0000"><b>Procedure </b></font>DirectSwap<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Tmp<font color="#000080">:</font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>GetMem<font color="#000080">(</font>Tmp<font color="#000080">,</font>Size<font color="#000080">);
 </font>Move<font color="#000080">(</font>El1<font color="#000080">^,</font>Tmp<font color="#000080">^,</font>Size<font color="#000080">);
 </font>Move<font color="#000080">(</font>El2<font color="#000080">^,</font>El1<font color="#000080">^,</font>Size<font color="#000080">);
 </font>Move<font color="#000080">(</font>Tmp<font color="#000080">^,</font>El2<font color="#000080">^,</font>Size<font color="#000080">);
 </font>FreeMem<font color="#000080">(</font>Tmp<font color="#000080">,</font>Size<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font><font color="#008000"><i>{ And finally a specific version of QSort() written in Assembler. It is
 non recursive and sorts Arrays of Words of up to 16383 elements (since
 it Uses the addresses of the elements rather than their indexes, and since
 SizeOf(Word)=2 -&gt; 16384*2=32768 &quot;=&quot; -32768, and the routine Uses signed
 comparisons between adresses.
  On my 386/33 it sorts 10 times an Array of 10000 Words in 3.6 sec, While
 the first QSort() does the same in 46 sec.

  Must be called With

 Qsort(Pointer to the first element, 0, elements-1)

  Use freely. if you include the source directly in your Program, credit
  must be given.
}

</i></font><font color="#FF0000"><b>Procedure </b></font>QSort<font color="#000080">(</font>Base<font color="#000080">:</font>Pointer<font color="#000080">;</font>L<font color="#000080">,</font>R<font color="#000080">:</font>Word<font color="#000080">);</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>TmpL<font color="#000080">,</font>TmpR<font color="#000080">,</font>TmpDI<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Asm
 </b></font><font color="#FF00FF">xor AX,AX
 PUSH AX
 PUSH AX     </font><font color="#008000"><i>{ 0 0 will act as a flag on the stack indicating that no more }
 </i></font><font color="#FF00FF">PUSH R      </font><font color="#008000"><i>{ (L,R) pairs need to be sorted }
 </i></font><font color="#FF00FF">PUSH L
@MainLoop:
 LES DI,Base
 MOV TmpDI,DI
 xor SI,SI
 MOV BX,DI
 POP AX    </font><font color="#008000"><i>{ AX&lt;-L }
 </i></font><font color="#FF00FF">MOV TmpL,AX
 MOV SI,AX
 SHL AX,1
 ADD DI,AX
 POP AX    </font><font color="#008000"><i>{ AX&lt;-R }
 </i></font><font color="#FF00FF">MOV TmpR,AX
 and AX,AX     </font><font color="#008000"><i>{ R can be never 0 except if this is the (0,0) flag }
 </i></font><font color="#FF00FF">JZ @</font><font color="#FF0000"><b>end
 </b></font>ADD SI<font color="#000080">,</font>AX
 <font color="#FF0000"><b>SHL </b></font>AX<font color="#000080">,</font><font color="#800000">1
 </font>ADD BX<font color="#000080">,</font>AX
 <font color="#FF0000"><b>and </b></font>SI<font color="#000080">,</font><font color="#800000">$FFFE
 </font>ADD SI<font color="#000080">,</font>TmpDI

 <font color="#008000"><i>{ ES:DI -&gt; Element[I] (L)
   ES:BX -&gt; Element[J] (R)
   ES:SI -&gt; Element[(L+R) div 2]
 }

 </i></font>MOV AX<font color="#000080">,</font>ES<font color="#000080">:[</font>SI<font color="#000080">]
@</font>Loop1<font color="#000080">:
 </font>MOV CX<font color="#000080">,</font>ES<font color="#000080">:[</font>DI<font color="#000080">]
 </font>CMP AX<font color="#000080">,</font>CX
 JNA <font color="#000080">@</font>Loop2
 ADD DI<font color="#000080">,</font><font color="#800000">2
 </font>JMP <font color="#000080">@</font>Loop1
<font color="#000080">@</font>Loop2<font color="#000080">:
 </font>MOV CX<font color="#000080">,</font>ES<font color="#000080">:[</font>BX<font color="#000080">]
 </font>CMP CX<font color="#000080">,</font>AX
 JNA <font color="#000080">@</font>Check
 SUB BX<font color="#000080">,</font><font color="#800000">2
 </font>JMP <font color="#000080">@</font>Loop2
<font color="#000080">@</font>Check<font color="#000080">:
 </font>CMP DI<font color="#000080">,</font>BX
 JG <font color="#000080">@</font>Cont1
 MOV CX<font color="#000080">,</font>ES<font color="#000080">:[</font>DI<font color="#000080">]
 </font>MOV DX<font color="#000080">,</font>ES<font color="#000080">:[</font>BX<font color="#000080">]
 </font>MOV ES<font color="#000080">:[</font>DI<font color="#000080">],</font>DX
 MOV ES<font color="#000080">:[</font>BX<font color="#000080">],</font>CX
 ADD DI<font color="#000080">,</font><font color="#800000">2
 </font>SUB BX<font color="#000080">,</font><font color="#800000">2
 </font>CMP DI<font color="#000080">,</font>BX
 JNG <font color="#000080">@</font>Loop1

<font color="#000080">@</font>Cont1<font color="#000080">:
 </font>SUB DI<font color="#000080">,</font>TmpDI
 SAR DI<font color="#000080">,</font><font color="#800000">1       </font><font color="#008000"><i>{ DI - I }
 </i></font>SUB BX<font color="#000080">,</font>TmpDI
 SAR BX<font color="#000080">,</font><font color="#800000">1       </font><font color="#008000"><i>{ BX - J }
 </i></font>CMP DI<font color="#000080">,</font>TmpR
 JGE <font color="#000080">@</font>Cont2
 PUSH TmpR      <font color="#008000"><i>{ I&lt;R }
 </i></font>PUSH DI
<font color="#000080">@</font>Cont2<font color="#000080">:
 </font>CMP TmpL<font color="#000080">,</font>BX
 JGE <font color="#000080">@</font>MainLoop
 PUSH BX        <font color="#008000"><i>{ L&lt;J }
 </i></font>PUSH TmpL
 JMP <font color="#000080">@</font>MainLoop

<font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ---------------------------   CUT  ----------------------------}
(*
From: ROLAND WODITSCH
Subj: QUICK SORT
*)

</i></font><font color="#FF0000"><b>UNIT </b></font>QSort5<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE
TYPE </b></font>OrdFunction <font color="#000080">= </font><font color="#FF0000"><b>FUNCTION</b></font><font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>a<font color="#000080">,</font>b<font color="#000080">):</font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Sortiere<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>SortArray<font color="#000080">; </font>Elementgroesse<font color="#000080">,</font>LoIndex<font color="#000080">,</font>HiIndex<font color="#000080">: </font>word<font color="#000080">;
                   </font>SortKleiner<font color="#000080">: </font>OrdFunction<font color="#000080">; </font>von<font color="#000080">,</font>bis<font color="#000080">:</font>word<font color="#000080">);

</font><font color="#008000"><i>{       SortArray  field to sort                                          }
{       LoIndex    the lowest,                                            }
{       HiIndex    the highest fieldindex like in the fielddeklarartion   }
{       OrdAdr     the funktion from typ OrdFunction (s.o.)               }
{       von, bis   the sortarea                                           }

{     befor calling (not befor bind!) your have to define a               }
{     asymmetric  order funktion :                                        }
{     function IrgendEinName(VAR x,y : TypDerFeldElemente):boolean        }
{     example: (*$F+*) function kleiner(VAR x,y: integer):boolean;        }
{                        begin kleiner:=x&lt;y end;  (*$F-*)                 }
{               not:  kleiner:=x&lt;=y  (not asymmetric!)                    }
{     attention: x and y must be VAR-parameters !!!                       }



</i></font><font color="#FF0000"><b>IMPLEMENTATION

procedure </b></font>Sortiere<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>SortArray<font color="#000080">; </font>ElementGroesse<font color="#000080">,</font>LoIndex<font color="#000080">,</font>HiIndex<font color="#000080">: </font>word<font color="#000080">;
                       </font>SortKleiner<font color="#000080">:</font>OrdFunction<font color="#000080">; </font>von<font color="#000080">,</font>bis<font color="#000080">:</font>word<font color="#000080">);
  </font><font color="#FF0000"><b>type </b></font>ArrayPtr <font color="#000080">= ^</font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>Mitte<font color="#000080">, </font>i0<font color="#000080">, </font>j0<font color="#000080">, </font>m0 <font color="#000080">: </font>ArrayPtr<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>Swap<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>x<font color="#000080">,</font>y<font color="#000080">; </font>size <font color="#000080">: </font>word<font color="#000080">);
    </font><font color="#FF0000"><b>begin
     INLINE </b></font><font color="#000080">(</font><font color="#800000">$1E</font><font color="#000080">/</font><font color="#800000">$C4</font><font color="#000080">/</font><font color="#800000">$B6</font><font color="#000080">/</font>X<font color="#000080">/</font><font color="#800000">$C5</font><font color="#000080">/</font><font color="#800000">$BE</font><font color="#000080">/</font>Y<font color="#000080">/</font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$8E</font><font color="#000080">/</font>SIZE<font color="#000080">/</font><font color="#800000">$E3</font><font color="#000080">/</font><font color="#800000">$0C</font><font color="#000080">/</font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$8A</font><font color="#000080">/</font><font color="#800000">$04</font><font color="#000080">/
             </font><font color="#800000">$86</font><font color="#000080">/</font><font color="#800000">$05</font><font color="#000080">/</font><font color="#800000">$26</font><font color="#000080">/</font><font color="#800000">$88</font><font color="#000080">/</font><font color="#800000">$04</font><font color="#000080">/</font><font color="#800000">$46</font><font color="#000080">/</font><font color="#800000">$47</font><font color="#000080">/</font><font color="#800000">$E2</font><font color="#000080">/</font><font color="#800000">$F4</font><font color="#000080">/</font><font color="#800000">$1F</font><font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>Element<font color="#000080">(</font>i <font color="#000080">: </font>word<font color="#000080">) : </font>ArrayPtr<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>Element<font color="#000080">:=</font>ptr<font color="#000080">(</font>seg<font color="#000080">(</font>SortArray<font color="#000080">),</font>ofs<font color="#000080">(</font>SortArray<font color="#000080">)+</font>i<font color="#000080">*</font>ElementGroesse<font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>inc<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>index <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>pointer <font color="#000080">: </font>ArrayPtr<font color="#000080">);
    </font><font color="#FF0000"><b>begin
      </b></font>index<font color="#000080">:=</font>succ<font color="#000080">(</font>index<font color="#000080">);
      </font>pointer<font color="#000080">:=</font>ptr<font color="#000080">(</font>seg<font color="#000080">(</font>pointer<font color="#000080">^),</font>ofs<font color="#000080">(</font>pointer<font color="#000080">^)+</font>ElementGroesse<font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>dec<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>index <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>pointer <font color="#000080">: </font>ArrayPtr<font color="#000080">);
    </font><font color="#FF0000"><b>begin
      </b></font>index<font color="#000080">:=</font>pred<font color="#000080">(</font>index<font color="#000080">);
      </font>pointer<font color="#000080">:=</font>ptr<font color="#000080">(</font>seg<font color="#000080">(</font>pointer<font color="#000080">^),</font>ofs<font color="#000080">(</font>pointer<font color="#000080">^)-</font>ElementGroesse<font color="#000080">)
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>E_Sort<font color="#000080">(</font>von<font color="#000080">, </font>bis <font color="#000080">: </font>word<font color="#000080">);
    </font><font color="#FF0000"><b>label </b></font>EXIT<font color="#000080">;
    </font><font color="#FF0000"><b>var </b></font>i<font color="#000080">, </font>j <font color="#000080">: </font>word<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font>bis<font color="#000080">&lt;=</font>von <font color="#FF0000"><b>then goto </b></font>EXIT<font color="#000080">;
      </font>i<font color="#000080">:=</font>von<font color="#000080">; </font>i0<font color="#000080">:=</font>Element<font color="#000080">(</font>i<font color="#000080">);
      </font><font color="#FF0000"><b>while </b></font>i<font color="#000080">&lt;</font>bis <font color="#FF0000"><b>do begin
        </b></font>m0<font color="#000080">:=</font>i0<font color="#000080">; </font>j<font color="#000080">:=</font>i<font color="#000080">; </font>j0<font color="#000080">:=</font>i0<font color="#000080">; </font>inc<font color="#000080">(</font>j<font color="#000080">,</font>j0<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font>j<font color="#000080">&lt;=</font>bis <font color="#FF0000"><b>do begin
          if </b></font>SortKleiner<font color="#000080">(</font>j0<font color="#000080">^,</font>m0<font color="#000080">^) </font><font color="#FF0000"><b>then </b></font>m0<font color="#000080">:=</font>j0<font color="#000080">;
          </font>inc<font color="#000080">(</font>j<font color="#000080">,</font>j0<font color="#000080">)
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* WHILE j *)
        </i></font><font color="#FF0000"><b>if </b></font>m0<font color="#000080">&lt;&gt;</font>i0 <font color="#FF0000"><b>then </b></font>Swap<font color="#000080">(</font>i0<font color="#000080">^,</font>m0<font color="#000080">^,</font>ElementGroesse<font color="#000080">);
        </font>inc<font color="#000080">(</font>i<font color="#000080">,</font>i0<font color="#000080">)
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* WHILE i *)
      </i></font>EXIT<font color="#000080">:
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* E_Sort *)

  </i></font><font color="#FF0000"><b>procedure </b></font>Sort<font color="#000080">(</font>von<font color="#000080">, </font>bis <font color="#000080">: </font>word<font color="#000080">);  </font><font color="#008000"><i>(* Rekursive Quicksort *)
    </i></font><font color="#FF0000"><b>label </b></font>EXIT<font color="#000080">;
    </font><font color="#FF0000"><b>var </b></font>i<font color="#000080">, </font>j <font color="#000080">: </font>word<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font>bis<font color="#000080">-</font>von<font color="#000080">&lt;</font><font color="#800000">6 </font><font color="#FF0000"><b>then begin </b></font>E_Sort<font color="#000080">(</font>von<font color="#000080">,</font>bis<font color="#000080">); </font><font color="#FF0000"><b>goto </b></font>EXIT <font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>i<font color="#000080">:=</font>von<font color="#000080">; </font>j<font color="#000080">:=</font>bis<font color="#000080">; </font>m0<font color="#000080">:=</font>Element<font color="#000080">((</font>i<font color="#000080">+</font>j<font color="#000080">) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">1</font><font color="#000080">);
      </font>move<font color="#000080">(</font>m0<font color="#000080">^,</font>Mitte<font color="#000080">^,</font>ElementGroesse<font color="#000080">); </font>i0<font color="#000080">:=</font>Element<font color="#000080">(</font>i<font color="#000080">); </font>j0<font color="#000080">:=</font>Element<font color="#000080">(</font>j<font color="#000080">);
      </font><font color="#FF0000"><b>while </b></font>i<font color="#000080">&lt;=</font>j <font color="#FF0000"><b>do begin
        while </b></font>SortKleiner<font color="#000080">(</font>i0<font color="#000080">^,</font>Mitte<font color="#000080">^) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>i<font color="#000080">,</font>i0<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font>SortKleiner<font color="#000080">(</font>Mitte<font color="#000080">^,</font>j0<font color="#000080">^) </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>j<font color="#000080">,</font>j0<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>i<font color="#000080">&lt;=</font>j <font color="#FF0000"><b>then begin
          if </b></font>i<font color="#000080">&lt;&gt;</font>j <font color="#FF0000"><b>then </b></font>Swap<font color="#000080">(</font>i0<font color="#000080">^,</font>j0<font color="#000080">^,</font>ElementGroesse<font color="#000080">);
          </font>inc<font color="#000080">(</font>i<font color="#000080">,</font>i0<font color="#000080">); </font>dec<font color="#000080">(</font>j<font color="#000080">,</font>j0<font color="#000080">)
        </font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>(* if i&lt;=j *)
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* while i&lt;=j *)
      </i></font><font color="#FF0000"><b>if </b></font>bis<font color="#000080">-</font>i<font color="#000080">&lt;</font>j<font color="#000080">-</font>von <font color="#FF0000"><b>then begin
                       if </b></font>i<font color="#000080">&lt;</font>bis <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>i<font color="#000080">,</font>bis<font color="#000080">);
                       </font><font color="#FF0000"><b>if </b></font>von<font color="#000080">&lt;</font>j <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>von<font color="#000080">,</font>j<font color="#000080">)
                       </font><font color="#FF0000"><b>end
                     else begin
                       if </b></font>von<font color="#000080">&lt;</font>j <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>von<font color="#000080">,</font>j<font color="#000080">);
                       </font><font color="#FF0000"><b>if </b></font>i<font color="#000080">&lt;</font>bis <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>i<font color="#000080">,</font>bis<font color="#000080">)
                       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>EXIT<font color="#000080">:
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* Sort *)

  </i></font><font color="#FF0000"><b>begin
    </b></font>getmem<font color="#000080">(</font>Mitte<font color="#000080">,</font>ElementGroesse<font color="#000080">);
    </font>Sort<font color="#000080">(</font>von<font color="#000080">-</font>LoIndex<font color="#000080">,</font>bis<font color="#000080">-</font>LoIndex<font color="#000080">);
    </font>freemem<font color="#000080">(</font>Mitte<font color="#000080">,</font>ElementGroesse<font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* Sort *)

</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">. </font><font color="#008000"><i>(* IMPLEMENTATION OF UNIT QSORT *)

{ ---------------------------   CUT  ----------------------------}
</i></font><font color="#FF0000"><b>unit </b></font>Qsort<font color="#000080">;

</font><font color="#008000"><i>{TQSort by Mike Junkin 10/19/95.
 DoQSort routine adapted from Peter Szymiczek's QSort procedure which
 was presented in issue#8 of The Unofficial Delphi Newsletter.}

</i></font><font color="#FF0000"><b>interface

uses
  </b></font>SysUtils<font color="#000080">, </font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>Messages<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">,
  </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TSwapEvent <font color="#000080">= </font><font color="#FF0000"><b>procedure </b></font><font color="#000080">(</font>Sender <font color="#000080">: </font>TObject<font color="#000080">; </font>e1<font color="#000080">,</font>e2 <font color="#000080">: </font>word<font color="#000080">) </font><font color="#FF0000"><b>of Object</b></font><font color="#000080">;
  </font>TCompareEvent <font color="#000080">= </font><font color="#FF0000"><b>procedure </b></font><font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>e1<font color="#000080">,</font>e2 <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Action <font color="#000080">: </font>integer<font color="#000080">) </font><font color="#FF0000"><b>of Object</b></font><font color="#000080">;

  </font>TQSort <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TComponent<font color="#000080">)
  </font><font color="#FF0000"><b>private
    </b></font>FCompare <font color="#000080">: </font>TCompareEvent<font color="#000080">;
    </font>FSwap <font color="#000080">: </font>TSwapEvent<font color="#000080">;
  </font><font color="#FF0000"><b>public
    procedure </b></font>DoQSort<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>uNElem<font color="#000080">: </font>word<font color="#000080">);
  </font><font color="#FF0000"><b>published
    property </b></font>Compare <font color="#000080">: </font>TCompareEvent <font color="#FF0000"><b>read </b></font>FCompare <font color="#FF0000"><b>write </b></font>FCompare<font color="#000080">;

    </font><font color="#FF0000"><b>property </b></font>Swap <font color="#000080">: </font>TSwapEvent <font color="#FF0000"><b>read </b></font>FSwap <font color="#FF0000"><b>write </b></font>FSwap<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure Register</b></font><font color="#000080">;

</font><font color="#FF0000"><b>implementation

procedure Register</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>RegisterComponents<font color="#000080">(</font><font color="#800000">'Mikes'</font><font color="#000080">, [</font>TQSort<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TQSort<font color="#000080">.</font>DoQSort<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>uNElem<font color="#000080">: </font>word<font color="#000080">);
</font><font color="#008000"><i>{ uNElem - number of elements to sort }

  </i></font><font color="#FF0000"><b>procedure </b></font>qSortHelp<font color="#000080">(</font>pivotP<font color="#000080">: </font>word<font color="#000080">; </font>nElem<font color="#000080">: </font>word<font color="#000080">);
  </font><font color="#FF0000"><b>label
    </b></font>TailRecursion<font color="#000080">,
    </font>qBreak<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>leftP<font color="#000080">, </font>rightP<font color="#000080">, </font>pivotEnd<font color="#000080">, </font>pivotTemp<font color="#000080">, </font>leftTemp<font color="#000080">: </font>word<font color="#000080">;
    </font>lNum<font color="#000080">: </font>word<font color="#000080">;
    </font>retval<font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>retval <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>TailRecursion<font color="#000080">:
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>nElem <font color="#000080">&lt;= </font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>then

        begin
          if </b></font><font color="#000080">(</font>nElem <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>then
            begin
              </b></font>rightP <font color="#000080">:= </font>pivotP <font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
              </font>FCompare<font color="#000080">(</font>Sender<font color="#000080">,</font>pivotP<font color="#000080">,</font>rightP<font color="#000080">,</font>retval<font color="#000080">);
              </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>retval <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Fswap<font color="#000080">(</font>Sender<font color="#000080">,</font>pivotP<font color="#000080">,</font>rightP<font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>exit<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>rightP <font color="#000080">:= (</font>nElem <font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) + </font>pivotP<font color="#000080">;
      </font>leftP <font color="#000080">:=  (</font>nElem <font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">) + </font>pivotP<font color="#000080">;
      </font><font color="#008000"><i>{ sort pivot, left, and right elements for &quot;median of 3&quot; }
      </i></font>FCompare<font color="#000080">(</font>Sender<font color="#000080">,</font>leftP<font color="#000080">,</font>rightP<font color="#000080">,</font>retval<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>retval <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Fswap<font color="#000080">(</font>Sender<font color="#000080">,</font>leftP<font color="#000080">, </font>rightP<font color="#000080">);
      </font>FCompare<font color="#000080">(</font>Sender<font color="#000080">,</font>leftP<font color="#000080">,</font>pivotP<font color="#000080">,</font>retval<font color="#000080">);

      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>retval <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Fswap<font color="#000080">(</font>Sender<font color="#000080">,</font>leftP<font color="#000080">, </font>pivotP<font color="#000080">)
      </font><font color="#FF0000"><b>else 
        begin
          </b></font>FCompare<font color="#000080">(</font>Sender<font color="#000080">,</font>pivotP<font color="#000080">,</font>rightP<font color="#000080">,</font>retval<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>retval <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Fswap<font color="#000080">(</font>Sender<font color="#000080">,</font>pivotP<font color="#000080">, </font>rightP<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>nElem <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>then
        begin
          </b></font>Fswap<font color="#000080">(</font>Sender<font color="#000080">,</font>pivotP<font color="#000080">, </font>leftP<font color="#000080">);
          </font>exit<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#008000"><i>{ now for the classic Horae algorithm }
      </i></font>pivotEnd <font color="#000080">:= </font>pivotP <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
      </font>leftP <font color="#000080">:= </font>pivotEnd<font color="#000080">;
      </font><font color="#FF0000"><b>repeat
        </b></font>FCompare<font color="#000080">(</font>Sender<font color="#000080">,</font>leftP<font color="#000080">, </font>pivotP<font color="#000080">,</font>retval<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>retval <font color="#000080">&lt;= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do
          begin

            if </b></font><font color="#000080">(</font>retval <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
              begin
                </b></font>Fswap<font color="#000080">(</font>Sender<font color="#000080">,</font>leftP<font color="#000080">, </font>pivotEnd<font color="#000080">);
                </font>Inc<font color="#000080">(</font>pivotEnd<font color="#000080">);
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>leftP <font color="#000080">&lt; </font>rightP<font color="#000080">) </font><font color="#FF0000"><b>then
              </b></font>Inc<font color="#000080">(</font>leftP<font color="#000080">)
            </font><font color="#FF0000"><b>else
              goto </b></font>qBreak<font color="#000080">;
            </font>FCompare<font color="#000080">(</font>Sender<font color="#000080">,</font>leftP<font color="#000080">, </font>pivotP<font color="#000080">,</font>retval<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{while}
        </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>leftP <font color="#000080">&lt; </font>rightP<font color="#000080">) </font><font color="#FF0000"><b>do
          begin
            </b></font>FCompare<font color="#000080">(</font>Sender<font color="#000080">,</font>pivotP<font color="#000080">, </font>rightP<font color="#000080">,</font>retval<font color="#000080">);
            </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>retval <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
              </b></font>Dec<font color="#000080">(</font>rightP<font color="#000080">)

            </font><font color="#FF0000"><b>else
              begin
                </b></font>FSwap<font color="#000080">(</font>Sender<font color="#000080">,</font>leftP<font color="#000080">, </font>rightP<font color="#000080">);
                </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>retval <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
                  begin
                    </b></font>Inc<font color="#000080">(</font>leftP<font color="#000080">);
                    </font>Dec<font color="#000080">(</font>rightP<font color="#000080">);
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                </font>break<font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{while}

      </i></font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>leftP <font color="#000080">&gt;= </font>rightP<font color="#000080">);
    </font>qBreak<font color="#000080">:
      </font>FCompare<font color="#000080">(</font>Sender<font color="#000080">,</font>leftP<font color="#000080">,</font>pivotP<font color="#000080">,</font>retval<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>retval <font color="#000080">&lt;= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>leftP<font color="#000080">);

      </font>leftTemp <font color="#000080">:= </font>leftP <font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
      </font>pivotTemp <font color="#000080">:= </font>pivotP<font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font><font color="#000080">((</font>pivotTemp <font color="#000080">&lt; </font>pivotEnd<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>leftTemp <font color="#000080">&gt;= </font>pivotEnd<font color="#000080">)) </font><font color="#FF0000"><b>do
        begin
          </b></font>Fswap<font color="#000080">(</font>Sender<font color="#000080">,</font>pivotTemp<font color="#000080">, </font>leftTemp<font color="#000080">);
          </font>Inc<font color="#000080">(</font>pivotTemp<font color="#000080">);
          </font>Dec<font color="#000080">(</font>leftTemp<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{while}
      </i></font>lNum <font color="#000080">:= (</font>leftP <font color="#000080">- </font>pivotEnd<font color="#000080">);
      </font>nElem <font color="#000080">:= ((</font>nElem <font color="#000080">+ </font>pivotP<font color="#000080">) -</font>leftP<font color="#000080">);

      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>nElem <font color="#000080">&lt; </font>lNum<font color="#000080">) </font><font color="#FF0000"><b>then
        begin
          </b></font>qSortHelp<font color="#000080">(</font>leftP<font color="#000080">, </font>nElem<font color="#000080">);
          </font>nElem <font color="#000080">:= </font>lNum<font color="#000080">;
        </font><font color="#FF0000"><b>end
      else
        begin

          </b></font>qSortHelp<font color="#000080">(</font>pivotP<font color="#000080">, </font>lNum<font color="#000080">);
          </font>pivotP <font color="#000080">:= </font>leftP<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>goto </b></font>TailRecursion<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{qSortHelp }

</i></font><font color="#FF0000"><b>begin
  if </b></font>Assigned<font color="#000080">(</font>FCompare<font color="#000080">) </font><font color="#FF0000"><b>and </b></font>Assigned<font color="#000080">(</font>FSwap<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    if </b></font><font color="#000080">(</font>uNElem <font color="#000080">&lt; </font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>then  </b></font>exit<font color="#000080">; </font><font color="#008000"><i>{ nothing to sort }
    </i></font>qSortHelp<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>uNElem<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ QSort }

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">. 

</font><font color="#008000"><i>{ demo }

</i></font><font color="#FF0000"><b>unit </b></font>Unit1<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
  </b></font>SysUtils<font color="#000080">, </font>WinTypes<font color="#000080">, </font>WinProcs<font color="#000080">, </font>Messages<font color="#000080">, </font>Classes<font color="#000080">, </font>Graphics<font color="#000080">, </font>Controls<font color="#000080">,
  </font>Forms<font color="#000080">, </font>Dialogs<font color="#000080">, </font>Grids<font color="#000080">, </font>Qsort<font color="#000080">, </font>StdCtrls<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TForm1 <font color="#000080">= </font><font color="#FF0000"><b>class</b></font><font color="#000080">(</font>TForm<font color="#000080">)
    </font>QSort1<font color="#000080">: </font>TQSort<font color="#000080">;
    </font>StringGrid1<font color="#000080">: </font>TStringGrid<font color="#000080">;
    </font>Button1<font color="#000080">: </font>TButton<font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>FormCreate<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>QSort1Compare<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>e1<font color="#000080">, </font>e2<font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Action<font color="#000080">: </font>Integer<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>QSort1Swap<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>e1<font color="#000080">, </font>e2<font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>procedure </b></font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Form1<font color="#000080">: </font>TForm1<font color="#000080">;

</font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{$R *.DFM}

</i></font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>FormCreate<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin

     with </b></font>StringGrid1 <font color="#FF0000"><b>do
     begin
          </b></font>Cells<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'the'</font><font color="#000080">;
          </font>Cells<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">'brown'</font><font color="#000080">;
          </font>Cells<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">] := </font><font color="#800000">'dog'</font><font color="#000080">;
          </font>Cells<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">] := </font><font color="#800000">'bit'</font><font color="#000080">;
          </font>Cells<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">] := </font><font color="#800000">'me'</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>QSort1Compare<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>e1<font color="#000080">, </font>e2<font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>var </b></font>Action<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
     with </b></font>Sender <font color="#FF0000"><b>as </b></font>TStringGrid <font color="#FF0000"><b>do
    begin
      if </b></font><font color="#000080">(</font>Cells<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">, </font>e1<font color="#000080">] &lt; </font>Cells<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">, </font>e2<font color="#000080">]) </font><font color="#FF0000"><b>then
        </b></font>Action <font color="#000080">:= -</font><font color="#800000">1
      </font><font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>Cells<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">, </font>e1<font color="#000080">] &gt; </font>Cells<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">, </font>e2<font color="#000080">]) </font><font color="#FF0000"><b>then

        </b></font>Action <font color="#000080">:= </font><font color="#800000">1
      </font><font color="#FF0000"><b>else
        </b></font>Action <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{with}

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>QSort1Swap<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">; </font>e1<font color="#000080">, </font>e2<font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>s<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">63</font><font color="#000080">];  </font><font color="#008000"><i>{ must be large enough to contain the longest string in the grid }
  </i></font>i<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  with </b></font>Sender <font color="#FF0000"><b>as </b></font>TStringGrid <font color="#FF0000"><b>do
    for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>ColCount <font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
    begin
      </b></font>s <font color="#000080">:= </font>Cells<font color="#000080">[</font>i<font color="#000080">, </font>e1<font color="#000080">];
      </font>Cells<font color="#000080">[</font>i<font color="#000080">, </font>e1<font color="#000080">] := </font>Cells<font color="#000080">[</font>i<font color="#000080">, </font>e2<font color="#000080">];
      </font>Cells<font color="#000080">[</font>i<font color="#000080">, </font>e2<font color="#000080">] := </font>s<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{for}

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TForm1<font color="#000080">.</font>Button1Click<font color="#000080">(</font>Sender<font color="#000080">: </font>TObject<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>QSort1<font color="#000080">.</font>DoQSort<font color="#000080">(</font>StringGrid1<font color="#000080">,</font>STringGrid1<font color="#000080">.</font>RowCount<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ---------------------------   CUT  ----------------------------}
{
&gt; Could someone please post some code on using a quick
&gt; sort to sort an array of strings?

   I can do even better than that. I can give you some code on a general qsort
routine that works like in C (if you're familiar with that). I. e. you can sort
any type of arrays, if only you supply the correct compare function. Here
goes...
}

</i></font><font color="#FF0000"><b>unit </b></font>QSort<font color="#000080">;
</font><font color="#008000"><i>{*********************************************************
 *                     QSORT.PAS                         *
 *           C-like QuickSort implementation             *
 *     Written 931118 by Bjrn Felten @ 2:203/208        *
 *           After an idea by Pontus Rydin               *
 *********************************************************}
</i></font><font color="#FF0000"><b>interface
type </b></font>CompFunc <font color="#000080">= </font><font color="#FF0000"><b>function</b></font><font color="#000080">(</font>Item1<font color="#000080">, </font>Item2 <font color="#000080">: </font>word<font color="#000080">) : </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>QuickSort<font color="#000080">(
    </font><font color="#FF0000"><b>var </b></font>Data<font color="#000080">;
</font><font color="#008000"><i>{An array. Must be [0..Count-1] and not [1..Count] or anything else! }
    </i></font>Count<font color="#000080">,
</font><font color="#008000"><i>{Number of elements in the array}
    </i></font>Size    <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#008000"><i>{Size in bytes of a single element -- e.g. 2 for integers or words,
4 for longints, 256 for strings and so on }
    </i></font>Compare <font color="#000080">: </font>CompFunc<font color="#000080">);
</font><font color="#008000"><i>{The function that decides which element is &quot;greater&quot; or &quot;less&quot;. Must
return an integer that's &lt; 0 if the first element is less, 0 if they're
equal and &gt; 0 if the first element is greater. A simple Compare for
words can look like this:

 function WordCompare(Item1, Item2: word): integer;
 begin
     WordCompare := MyArray[Item1] - MyArray[Item2]
 end;

NB. It's not the =indices= that shall be compared, it's the elements that
the supplied indices points to! Very important to remember!
Also note that the array may be sorted in descending order just by
means of a simple swap of Item1 and Item2 in the example.}

</i></font><font color="#FF0000"><b>implementation
procedure </b></font>QuickSort<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>Swap<font color="#000080">(</font>Item1<font color="#000080">, </font>Item2 <font color="#000080">: </font>word<font color="#000080">);
  </font><font color="#FF0000"><b>var  </b></font>P1<font color="#000080">, </font>P2 <font color="#000080">: ^</font>byte<font color="#000080">; </font>I <font color="#000080">: </font>word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
     if </b></font>Item1 <font color="#000080">&lt;&gt; </font>Item2 <font color="#FF0000"><b>then
     begin
          </b></font>I  <font color="#000080">:= </font>Size<font color="#000080">;
          </font>P1 <font color="#000080">:= @</font>Data<font color="#000080">; </font>inc<font color="#000080">(</font>P1<font color="#000080">, </font>Item1 <font color="#000080">* </font>Size<font color="#000080">);
          </font>P2 <font color="#000080">:= @</font>Data<font color="#000080">; </font>inc<font color="#000080">(</font>P2<font color="#000080">, </font>Item2 <font color="#000080">* </font>Size<font color="#000080">);
          </font><font color="#FF0000"><b>asm
            </b></font><font color="#FF00FF">mov  cx,I      </font><font color="#008000"><i>{ Size }
            </i></font><font color="#FF00FF">les  di,P1
            push ds
            lds  si,P2
          @L:
            mov  ah,es:[di]
            lodsb
            mov  [si-1],ah
            stosb
            loop @L
            pop  ds
          </font><font color="#FF0000"><b>end
      end
  end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>Sort<font color="#000080">(</font>Left<font color="#000080">, </font>Right<font color="#000080">: </font>integer<font color="#000080">);
  </font><font color="#FF0000"><b>var  </b></font>i<font color="#000080">, </font>j<font color="#000080">, </font>x<font color="#000080">, </font>y <font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
     </b></font>i <font color="#000080">:= </font>Left<font color="#000080">; </font>j <font color="#000080">:= </font>Right<font color="#000080">; </font>x <font color="#000080">:= (</font>Left<font color="#000080">+</font>Right<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
     </font><font color="#FF0000"><b>repeat
        while </b></font>compare<font color="#000080">(</font>i<font color="#000080">, </font>x<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
        </font><font color="#FF0000"><b>while </b></font>compare<font color="#000080">(</font>x<font color="#000080">, </font>j<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>j<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&lt;= </font>j <font color="#FF0000"><b>then
        begin
           </b></font>swap<font color="#000080">(</font>i<font color="#000080">, </font>j<font color="#000080">); </font>inc<font color="#000080">(</font>i<font color="#000080">); </font>dec<font color="#000080">(</font>j<font color="#000080">)
        </font><font color="#FF0000"><b>end
     until </b></font>i <font color="#000080">&gt; </font>j<font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>Left <font color="#000080">&lt; </font>j <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>Left<font color="#000080">, </font>j<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&lt; </font>Right <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>i<font color="#000080">, </font>Right<font color="#000080">)
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin </b></font>Sort<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>Count<font color="#000080">) </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{ of unit }

{ A simple testprogram can look like this: }

</i></font><font color="#FF0000"><b>program </b></font>QS_Test<font color="#000080">; </font><font color="#008000"><i>{Test QuickSort  la C}
</i></font><font color="#FF0000"><b>uses </b></font>qsort<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>v<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">9999</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;
    </font>i<font color="#000080">: </font>word<font color="#000080">;

</font><font color="#008000"><i>{$F+} {Must be compiled as FAR calls!}
</i></font><font color="#FF0000"><b>function </b></font>cmpr<font color="#000080">(</font>a<font color="#000080">, </font>b<font color="#000080">: </font>word<font color="#000080">): </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin </b></font>cmpr <font color="#000080">:= </font>v<font color="#000080">[</font>a<font color="#000080">] - </font>v<font color="#000080">[</font>b<font color="#000080">] </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>cmpr2<font color="#000080">(</font>a<font color="#000080">, </font>b<font color="#000080">: </font>word<font color="#000080">): </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin </b></font>cmpr2 <font color="#000080">:= </font>v<font color="#000080">[</font>b<font color="#000080">] - </font>v<font color="#000080">[</font>a<font color="#000080">] </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>begin
 </b></font>randomize<font color="#000080">;
 </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">9999 </font><font color="#FF0000"><b>do </b></font>v<font color="#000080">[</font>i<font color="#000080">] := </font>random<font color="#000080">(</font><font color="#800000">20000</font><font color="#000080">);
 </font>quicksort<font color="#000080">(</font>v<font color="#000080">, </font><font color="#800000">10000</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>cmpr<font color="#000080">);  </font><font color="#008000"><i>{in order lo to hi}
 </i></font>quicksort<font color="#000080">(</font>v<font color="#000080">, </font><font color="#800000">10000</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>cmpr2<font color="#000080">); </font><font color="#008000"><i>{we now have a sorted list, sort it in
                                {reverse -- nasty for qsort!}
 </i></font>quicksort<font color="#000080">(</font>v<font color="#000080">, </font><font color="#800000">10000</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>cmpr<font color="#000080">);  </font><font color="#008000"><i>{and reverse again}
 </i></font>quicksort<font color="#000080">(</font>v<font color="#000080">, </font><font color="#800000">10000</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>cmpr<font color="#000080">);  </font><font color="#008000"><i>{sort a sorted list -- also not very popular}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ---------------------------   CUT  ----------------------------}

{************************************************}
{                                                }
{ QuickSort Demo                                 }
{ Copyright (c) 1985,90 by Borland International } { und: Robert Beicht ;-) }
{                                                }
{************************************************}

</i></font><font color="#FF0000"><b>program </b></font>QSort<font color="#000080">;
</font><font color="#008000"><i>{$R-,S-}
</i></font><font color="#FF0000"><b>uses </b></font>Crt<font color="#000080">;

</font><font color="#008000"><i>{ This program demonstrates the quicksort algorithm, which      }
{ provides an extremely efficient method of sorting arrays in   }
{ memory. The program generates a list of 1000 random numbers   }
{ between 0 and 29999, and then sorts them using the QUICKSORT  }
{ procedure. Finally, the sorted list is output on the screen.  }
{ Note that stack and range checks are turned off (through the  }
{ compiler directive above) to optimize execution speed.        }

</i></font><font color="#FF0000"><b>const
  </b></font>Max <font color="#000080">= </font><font color="#800000">100</font><font color="#000080">;

</font><font color="#FF0000"><b>type                                                                  </b></font><font color="#008000"><i>{ ***** }
  </i></font>PData <font color="#000080">= ^</font>TData<font color="#000080">;                                                     </font><font color="#008000"><i>{ ***** }
  </i></font>TData <font color="#000080">= </font><font color="#FF0000"><b>record                                                      </b></font><font color="#008000"><i>{ ***** }
    </i></font>NachName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">25</font><font color="#000080">];                                             </font><font color="#008000"><i>{ ***** }
    </i></font>VorName<font color="#000080">:  </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">25</font><font color="#000080">];                                             </font><font color="#008000"><i>{ ***** }
    {..}                                                              { ***** }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                                </font><font color="#008000"><i>{ ***** }
  
  </i></font>List <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>Max<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TData<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Data<font color="#000080">: </font>List<font color="#000080">;
  </font>I<font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Less<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>d1<font color="#000080">,</font>d2<font color="#000080">:</font>TData<font color="#000080">): </font>Boolean<font color="#000080">;                              </font><font color="#008000"><i>{ ***** }
</i></font><font color="#FF0000"><b>begin                                                                 </b></font><font color="#008000"><i>{ ***** }
  </i></font><font color="#FF0000"><b>if </b></font>d1<font color="#000080">.</font>NachName <font color="#000080">&lt; </font>d2<font color="#000080">.</font>NachName <font color="#FF0000"><b>then </b></font>Less <font color="#000080">:= </font>True  <font color="#FF0000"><b>else                </b></font><font color="#008000"><i>{ ***** }
  </i></font><font color="#FF0000"><b>if </b></font>d1<font color="#000080">.</font>NachName <font color="#000080">&gt; </font>d2<font color="#000080">.</font>NachName <font color="#FF0000"><b>then </b></font>Less <font color="#000080">:= </font>False <font color="#FF0000"><b>else                </b></font><font color="#008000"><i>{ ***** }
    </i></font><font color="#FF0000"><b>if </b></font>d1<font color="#000080">.</font>VorName <font color="#000080">&lt; </font>d2<font color="#000080">.</font>VorName <font color="#FF0000"><b>then </b></font>Less <font color="#000080">:= </font>True  <font color="#FF0000"><b>else                </b></font><font color="#008000"><i>{ ***** }
    </i></font><font color="#FF0000"><b>if </b></font>d1<font color="#000080">.</font>VorName <font color="#000080">&gt; </font>d2<font color="#000080">.</font>VorName <font color="#FF0000"><b>then </b></font>Less <font color="#000080">:= </font>False <font color="#FF0000"><b>else </b></font>Less <font color="#000080">:= </font>False<font color="#000080">; </font><font color="#008000"><i>{ ***** }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                                  </font><font color="#008000"><i>{ ***** }

{ QUICKSORT sorts elements in the array A with indices between  }
{ LO and HI (both inclusive). Note that the QUICKSORT proce-    }
{ dure provides only an &quot;interface&quot; to the program. The actual  }
{ processing takes place in the SORT procedure, which executes  }
{ itself recursively.                                           }

</i></font><font color="#FF0000"><b>procedure </b></font>QuickSort<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>A<font color="#000080">: </font>List<font color="#000080">; </font>Lo<font color="#000080">, </font>Hi<font color="#000080">: </font>Integer<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>Sort<font color="#000080">(</font>l<font color="#000080">, </font>r<font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">, </font>j<font color="#000080">, </font>x<font color="#000080">: </font>integer<font color="#000080">;                                                   </font><font color="#008000"><i>{ ***** }
  </i></font>y<font color="#000080">: </font>TData<font color="#000080">;                                                           </font><font color="#008000"><i>{ ***** }
</i></font><font color="#FF0000"><b>begin
  </b></font>i <font color="#000080">:= </font>l<font color="#000080">; </font>j <font color="#000080">:= </font>r<font color="#000080">; </font>x <font color="#000080">:= (</font>l<font color="#000080">+</font>r<font color="#000080">) </font><font color="#FF0000"><b>DIV </b></font><font color="#800000">2</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    while </b></font>Less<font color="#000080">(</font>a<font color="#000080">[</font>i<font color="#000080">], </font>a<font color="#000080">[</font>x<font color="#000080">]) </font><font color="#FF0000"><b>do </b></font>i <font color="#000080">:= </font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;                             </font><font color="#008000"><i>{ ***** }
    </i></font><font color="#FF0000"><b>while </b></font>Less<font color="#000080">(</font>a<font color="#000080">[</font>x<font color="#000080">], </font>a<font color="#000080">[</font>j<font color="#000080">]) </font><font color="#FF0000"><b>do </b></font>j <font color="#000080">:= </font>j <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;                             </font><font color="#008000"><i>{ ***** }
    </i></font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&lt;= </font>j <font color="#FF0000"><b>then
    begin
      </b></font>y <font color="#000080">:= </font>a<font color="#000080">[</font>i<font color="#000080">]; </font>a<font color="#000080">[</font>i<font color="#000080">] := </font>a<font color="#000080">[</font>j<font color="#000080">]; </font>a<font color="#000080">[</font>j<font color="#000080">] := </font>y<font color="#000080">;
      </font>i <font color="#000080">:= </font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">; </font>j <font color="#000080">:= </font>j <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>i <font color="#000080">&gt; </font>j<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>l <font color="#000080">&lt; </font>j <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>l<font color="#000080">, </font>j<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&lt; </font>r <font color="#FF0000"><b>then </b></font>Sort<font color="#000080">(</font>i<font color="#000080">, </font>r<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{QuickSort}</i></font><font color="#000080">;
  </font>Sort<font color="#000080">(</font>Lo<font color="#000080">,</font>Hi<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{QSort}

  (*Initialisiere List*)
  </i></font>Sort<font color="#000080">(</font>List<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Count<font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SORTING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0066.PAS">Original</a><b>]</b></p></body>
</html>
